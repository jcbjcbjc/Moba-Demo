{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/UIMain.ts"],"names":["_decorator","Component","Label","Sprite","director","UIManager","User","LoadResUtil","DataManager","EventManager","EventType","InputBox","Validate","RoomService","ChatManager","MatchService","ccclass","property","UIMain","start","levelText","string","Instance","user","character","level","expText","exp","levelExp","nicknameText","nickname","coinText","coin","cid","chatRedSprite","node","active","avatarSprite","spriteFrame","load_local_sprite","characters","Avatar","addListener","UserCoinChange","OnUserCoinChange","OnChangeRedNum","roomMessages","param","SetUpClick","obj","show","OnClickAvatar","uiCharacterDetail","SendCharacterDetail","userId","tid","SelectHero","loadScene","OnClickBag","uiBag","SetUpOpenMode","OnClickShop","uiShop","OnClickPowerRanking","uiPowerRanking","OnClickAuction","uiAuction","OnClickOpenRoom","SendValidateOpenRoom","OnClickJoinRoom","inputBox","Show","this_","UIInputBox_OnClickYes","roomId","isIntegerLarge0","SendAddRoomRequest","OnClickChat","uiChat","arr","GetChannelChatRedNum","ChangeChatChannel","console","log","OnClickStartMatch","SendStartMatch","OnClickFollowLive","onDestroy","removeAll"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, Label, Sprite, SpriteFrame, loader, resources, director } from 'cc';\r\nimport { MessageBox } from './Common/MessageBox';\r\nimport { UIManager } from './Common/UIManager';\r\nimport { UISystemConfig } from './UISystemConfig';\r\nimport { User } from '../Models/User';\r\nimport { LoadResUtil } from '../Utils/LoadResUtil';\r\nimport { DataManager } from '../Managers/DataManager';\r\nimport { UIBag } from './Bag/UIBag';\r\nimport { UIShop } from './Shop/UIShop';\r\nimport { EventManager } from './Common/Event/EventManager';\r\nimport { EventType } from './Common/Event/EventType';\r\nimport { UIPowerRanking } from './PowerRanking/UIPowerRanking';\r\nimport { UIAuction } from './Auction/UIAuction';\r\nimport { InputBox } from './Common/InputBox';\r\nimport { Validate } from '../Utils/Validate';\r\nimport { RoomService } from '../Services/RoomService';\r\nimport { UIChat } from './Chat/UIChat';\r\nimport { ChatManager } from '../Managers/ChatManager';\r\nimport { MatchService } from '../Services/MatchService';\r\nimport { UICharacterDetail } from './UICharacterDetail/UICharacterDetail';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('UIMain')\r\nexport class UIMain extends Component {\r\n\r\n  @property(Label)\r\n  public levelText: Label = null as unknown as Label;\r\n  @property(Label)\r\n  public expText: Label = null as unknown as Label;\r\n  @property(Label)\r\n  public nicknameText: Label = null as unknown as Label;\r\n  @property(Label)\r\n  public coinText: Label = null as unknown as Label;\r\n  @property(Sprite)\r\n  public avatarSprite: Sprite = null as unknown as Sprite;\r\n  @property(Sprite)\r\n  public chatRedSprite: Sprite = null as unknown as Sprite;\r\n\r\n  async start() {\r\n    this.levelText.string = '等级：' + User.Instance.user.character?.level;\r\n    this.expText.string = '经验：' + User.Instance.user.character?.exp + '/' + User.Instance.user.character?.levelExp;\r\n    this.nicknameText.string = '昵称：' + User.Instance.user.nickname;\r\n    this.coinText.string = '金币：' + User.Instance.user.coin;\r\n    let cid = User.Instance.user.character?.cid as number;  //角色配置id\r\n    this.chatRedSprite.node.active = false;\r\n\r\n    this.avatarSprite.spriteFrame = await LoadResUtil.load_local_sprite(DataManager.Instance.characters[cid].Avatar + '/spriteFrame');\r\n    //  console.log(this.avatarSprite.spriteFrame)\r\n    EventManager.Instance.addListener(EventType.UserCoinChange, this.OnUserCoinChange, this);\r\n    EventManager.Instance.addListener(EventType.OnChangeRedNum, this.OnChangeRedNum, this);\r\n    ChatManager.Instance.roomMessages = [];  //没有房间清空消息\r\n    this.OnChangeRedNum();\r\n  }\r\n\r\n  /**\r\n   * 金币发生变化\r\n   * @param param \r\n   */\r\n  private OnUserCoinChange(param: any) {\r\n    let coin = param[0] as number;\r\n    this.coinText.string = '金币：' + coin;\r\n  }\r\n\r\n  /**\r\n   * 设置\r\n   */\r\n  SetUpClick() {\r\n    let obj = UIManager.Instance.show(\"UISystemConfig\");\r\n    //    console.log('obj='+obj)\r\n  }\r\n\r\n  /**\r\n   * 点击头像\r\n   */\r\n   public async OnClickAvatar() {\r\n    let uiCharacterDetail = await UIManager.Instance.show(\"UICharacterDetail\") as UICharacterDetail;\r\n        uiCharacterDetail.SendCharacterDetail(User.Instance.user.character.userId, User.Instance.user.character?.tid as number, 1);\r\n  }\r\n\r\n  /**\r\n   * 选择英雄\r\n   */\r\n  SelectHero() {\r\n    director.loadScene('CharacterSelect');\r\n  }\r\n\r\n  /**\r\n   * 点击背包\r\n   */\r\n  public async OnClickBag() {\r\n    let uiBag = await UIManager.Instance.show(\"UIBag\") as UIBag;\r\n    uiBag.SetUpOpenMode(1);\r\n  }\r\n\r\n  /**\r\n    * 点击商店\r\n    */\r\n  public async OnClickShop() {\r\n    let uiShop = await UIManager.Instance.show(\"UIShop\") as UIShop;\r\n  }\r\n\r\n  /**\r\n   * 点击战力排行\r\n   */\r\n  public async OnClickPowerRanking() {\r\n    let uiPowerRanking = await UIManager.Instance.show(\"UIPowerRanking\") as UIPowerRanking;\r\n  }\r\n\r\n  /**\r\n   * 点击拍卖大厅\r\n   */\r\n  public async OnClickAuction() {\r\n    let uiAuction = await UIManager.Instance.show(\"UIAuction\") as UIAuction;\r\n  }\r\n\r\n  /**\r\n   * 点击开房间\r\n   */\r\n  OnClickOpenRoom() {\r\n    RoomService.Instance.SendValidateOpenRoom();\r\n  }\r\n\r\n  /**\r\n  * 点击加入房间\r\n  */\r\n  async OnClickJoinRoom() {\r\n    let inputBox = await InputBox.Show('请输入房间id', \"加入房间\");\r\n    let this_ = this;\r\n    EventManager.Instance.addListener(EventType.UIInputBox_OnClickYes, function (param: any): string {\r\n      let roomId = param[0];\r\n      if (!Validate.isIntegerLarge0(roomId)) {\r\n        return '房间id必须大于0';\r\n      }\r\n      RoomService.Instance.SendAddRoomRequest(roomId);\r\n      return '';\r\n    }, inputBox);\r\n  }\r\n\r\n  /**\r\n   * 点击聊天\r\n   */\r\n  public async OnClickChat() {\r\n    let uiChat = await UIManager.Instance.show(\"UIChat\") as UIChat;\r\n    let arr = ChatManager.Instance.GetChannelChatRedNum(1);\r\n    uiChat.ChangeChatChannel(arr[0]);\r\n  }\r\n\r\n  /**\r\n   * 消息数量改变\r\n   */\r\n  private OnChangeRedNum() {\r\n    let arr = ChatManager.Instance.GetChannelChatRedNum(1);\r\n    console.log('OnChangeRedNum arr=' + arr)\r\n    if (arr[1] > 0) {\r\n      this.chatRedSprite.node.active = true;\r\n    } else {\r\n      this.chatRedSprite.node.active = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 点击匹配对抗\r\n   */\r\n  public async OnClickStartMatch() {\r\n    MatchService.Instance.SendStartMatch();\r\n  }\r\n\r\n  /**\r\n   * 点击关注/直播\r\n   */\r\n  public OnClickFollowLive() {\r\n    director.loadScene('FollowLive');\r\n  }\r\n\r\n  onDestroy() {\r\n    console.log('onDestroy')\r\n    EventManager.Instance.removeAll(this);\r\n  }\r\n}\r\n"]}