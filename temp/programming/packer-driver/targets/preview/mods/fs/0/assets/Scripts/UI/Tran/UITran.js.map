{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Tran/UITran.ts"],"names":["_decorator","Prefab","instantiate","Button","UIWindow","proto","EventManager","ListView","UITranItem","UITranDetailItem","EventType","MessageBox","MessageBoxType","ItemService","ccclass","property","NItem","Result","UITran","start","listMain","owner","Instance","addListener","ListView_OnItemSelected","OnItemSelected","OnQueryTran_UI","OnBuyTran_UI","RefieshUI","param","uiTranItem","console","log","itemDefine","OnClickBuy","Show","confirmObj","Name","Confirm","this_","UIMessageBox_OnClickYes","SendBuyTran","userId","ID","SetUserLoadList","SendQueryTran","ClearList","items","length","uiTranDetailItem","node","active","i","item","itemPrefab","getComponent","SetItemInfo","selectedIndex","AddItem","RemoveAll","onDestroy","removeListener","removeAll"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, Prefab, instantiate, Button } from 'cc';\r\nimport { UIWindow } from '../Common/UIWindow';\r\nimport { User } from '../../Models/User';\r\nimport proto from '../../../Proto/proto.js';\r\nimport { EventManager } from '../Common/Event/EventManager';\r\nimport { ListView } from '../Common/ListView/ListView';\r\nimport { UITranItem } from './UITranItem';\r\nimport { ListViewItem } from '../Common/ListView/ListViewItem';\r\nimport { UITranDetailItem } from './UITranDetailItem';\r\nimport { EventType } from '../Common/Event/EventType';\r\nimport { TabView } from '../Common/TabView/TabView';\r\nimport { DataManager } from '../../Managers/DataManager';\r\nimport { MessageBox, MessageBoxType } from '../Common/MessageBox';\r\nimport { ItemService } from '../../Services/ItemService';\r\nconst { ccclass, property } = _decorator;\r\nconst { NItem, Result } = proto;\r\n\r\n@ccclass('UITran')\r\nexport class UITran extends UIWindow {\r\n \r\n    @property(Prefab)\r\n    public itemPrefab:Prefab=null as unknown as Prefab;\r\n    @property(ListView)\r\n    public listMain:ListView=null as unknown as ListView;\r\n    @property(UITranDetailItem)\r\n    public uiTranDetailItem=null as unknown as UITranDetailItem;\r\n    @property(Button)\r\n    public buyButton=null as unknown as Button;  //购买按钮\r\n    public selectedIndex:number=0;\r\n    private userId:number=0; //用户id\r\n\r\n    private uiTranItem:UITranItem=null as unknown as UITranItem;\r\n \r\n    start () {\r\n        this.listMain.owner=this;\r\n        EventManager.Instance.addListener(EventType.ListView_OnItemSelected,this.OnItemSelected,this);\r\n        EventManager.Instance.addListener(EventType.OnQueryTran_UI,this.OnQueryTran_UI,this); \r\n        EventManager.Instance.addListener(EventType.OnBuyTran_UI,this.RefieshUI,this); \r\n    }\r\n\r\n    private OnItemSelected(param:any){\r\n        this.uiTranItem=param[0] as UITranItem;\r\n        console.log('OnItemSelected='+this.uiTranItem.itemDefine)\r\n    }\r\n\r\n    /**\r\n     * 点击购买\r\n     */\r\n    public async OnClickBuy(){\r\n        if (!this.uiTranItem){\r\n            MessageBox.Show(\"请选择要购买的道具\",\"购买提示\");\r\n            return;\r\n        }\r\n        let itemDefine=this.uiTranItem.itemDefine;\r\n        // let shopItemDefine=this.uiTranItem.shopItemDefine;\r\n        let confirmObj= await MessageBox.Show(\"确定要购买\"+itemDefine.Name+\"吗？\", \"购买\", MessageBoxType.Confirm,\"确定\",\"取消\"); \r\n        let this_=this;\r\n        EventManager.Instance.addListener(EventType.UIMessageBox_OnClickYes,function(){\r\n            ItemService.Instance.SendBuyTran(this_.userId,itemDefine.ID);\r\n        },confirmObj);\r\n        \r\n     }\r\n    /**\r\n     * 设置用户加载列表\r\n     * @param userId \r\n     */\r\n     public SetUserLoadList(userId:number){\r\n         this.userId=userId;\r\n         this.RefieshUI();\r\n     }\r\n\r\n    public RefieshUI(){\r\n        ItemService.Instance.SendQueryTran(this.userId);\r\n    }\r\n    \r\n\r\n    /**\r\n     * 查询用户交易响应\r\n     * @param param \r\n     */\r\n    private async OnQueryTran_UI(param: any){\r\n        this.ClearList();\r\n        let items=param[0] as Array<NItem>;\r\n        if(!items || items.length < 1){\r\n            this.uiTranDetailItem.node.active=false;\r\n            return;\r\n        }\r\n        this.uiTranDetailItem.node.active=true;\r\n         for(let i=0;i<items.length;i++){\r\n             let item=items[i];\r\n             let node=instantiate(this.itemPrefab);\r\n             let uiTranItem=node.getComponent(UITranItem);\r\n             await uiTranItem?.SetItemInfo(item,this.uiTranDetailItem,i==this.selectedIndex,i,this);\r\n             this.listMain.AddItem(node,uiTranItem as ListViewItem);\r\n         }\r\n    }\r\n\r\n    private ClearList():void\r\n    {\r\n        this.listMain.RemoveAll();\r\n    }\r\n\r\n    onDestroy(){\r\n        console.log('onDestroy')\r\n        this.listMain.removeListener();\r\n        EventManager.Instance.removeAll(this);\r\n    }\r\n\r\n}\r\n"]}