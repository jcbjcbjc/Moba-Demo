{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Battle/Managers/CharacterManager.ts"],"names":["CharacterManager","instantiate","TeamType2","LoadResUtil","DataManager","CreatureManager","User","BattleManager","Creature","CreatureType","BattleGlobal","BattleMode","AddCharacter","character","characterList","push","Clear","CreateCharacter","teamType2","teamArr","Blue","Instance","MyTeam","EnemyTeam","roomUsers","room","my","enemy","i","length","characterNode","cId","cCharacterId","characterDefine","characters","resource","Resource","console","log","prefab","loadPrefab","node","addChild","user","Character","AddCreature","battleMode","Battle","id","currentCharacter","Live","targetLiveUserId"],"mappings":";;;wKAgBaA,gB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAdJC,MAAAA,W,OAAAA,W;;AADAC,MAAAA,S,iBAAAA,S;;AAEAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,e,iBAAAA,e;;AACAC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,Y,kBAAAA,Y;;AACAC,MAAAA,U,kBAAAA,U;;;;;;;AAET;AACA;AACA;kCACaX,gB,GAAN,MAAMA,gBAAN,CAAsB;AAAA;AAAA,iDAIY,EAJZ;AAAA;;AAMxB;AACL;AACA;AACA;AACWY,QAAAA,YAAY,CAACC,SAAD,EAAoB;AACnC,eAAKC,aAAL,CAAmBC,IAAnB,CAAwBF,SAAxB;AACH;AAED;AACJ;AACA;;;AACWG,QAAAA,KAAK,GAAE;AACV,eAAKF,aAAL,GAAmB,EAAnB;AACH;AAED;AACJ;AACA;;;AACiBG,QAAAA,eAAe,CAACC,SAAD,EAAqB;AAAA;AAC7C,gBAAIC,OAAO,GAAE;AAAA;AAAA,wCAAUC,IAAV,IAAgBF,SAAhB,GAA4B;AAAA;AAAA,gDAAcG,QAAd,CAAuBC,MAAnD,GAA4D;AAAA;AAAA,gDAAcD,QAAd,CAAuBE,SAAhG;AACA,gBAAIC,SAAS,GAAE;AAAA;AAAA,wCAAUJ,IAAV,IAAgBF,SAAhB,GAA4B;AAAA;AAAA,8BAAKG,QAAL,CAAcI,IAAd,CAAmBC,EAA/C,GAAoD;AAAA;AAAA,8BAAKL,QAAL,CAAcI,IAAd,CAAmBE,KAAtF;;AAEA,iBAAI,IAAIC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACT,OAAO,CAACU,MAAtB,EAA6BD,CAAC,EAA9B,EAAiC;AAC9B,kBAAIE,aAAa,GAACX,OAAO,CAACS,CAAD,CAAzB;;AACA,kBAAG,CAACJ,SAAS,CAACI,CAAD,CAAb,EAAiB;AACf;AACD;;AACD,kBAAIG,GAAG,GAACP,SAAS,CAACI,CAAD,CAAT,CAAaI,YAArB;AACA,kBAAIC,eAAe,GAAG;AAAA;AAAA,8CAAYZ,QAAZ,CAAqBa,UAArB,CAAgCH,GAAhC,CAAtB;AAEA,kBAAII,QAAQ,GAACF,eAAe,CAACG,QAA7B;AACAC,cAAAA,OAAO,CAACC,GAAR,CAAY,SAAOP,GAAP,GAAW,YAAX,GAAwBI,QAApC;AACA,kBAAII,MAAM,SAAQ;AAAA;AAAA,8CAAYC,UAAZ,CAAuBL,QAAvB,CAAlB;AACA,kBAAIM,IAAI,GAACxC,WAAW,CAACsC,MAAD,CAApB;AACAT,cAAAA,aAAa,CAACY,QAAd,CAAuBD,IAAvB,EAZ8B,CAc9B;;AACA,kBAAI5B,SAAS,GAAC;AAAA;AAAA,wCAAaK,SAAb,EAAwBuB,IAAxB,EAA8BR,eAA9B,EAA+CT,SAAS,CAACI,CAAD,CAAT,CAAae,IAA5D,EAAkE;AAAA;AAAA,gDAAaC,SAA/E,CAAd;AACA;AAAA;AAAA,sDAAgBvB,QAAhB,CAAyBwB,WAAzB,CAAqCJ,IAArC,EAA2C5B,SAA3C;AACAb,cAAAA,gBAAgB,CAACqB,QAAjB,CAA0BT,YAA1B,CAAuCC,SAAvC,EAjB8B,CAkB9B;;AACD,kBAAG;AAAA;AAAA,gDAAaiC,UAAb,IAA2B;AAAA;AAAA,4CAAWC,MAAzC,EAAgD;AAAK;AACnD,oBAAG;AAAA;AAAA,kCAAK1B,QAAL,CAAcsB,IAAd,CAAmBK,EAAnB,IAAyBnC,SAAS,CAAC8B,IAAV,CAAeK,EAA3C,EAA8C;AAC5C;AAAA;AAAA,sDAAc3B,QAAd,CAAuB4B,gBAAvB,GAAwCpC,SAAxC;AACD;AACF,eAJD,MAIM,IAAG;AAAA;AAAA,gDAAaiC,UAAb,IAA2B;AAAA;AAAA,4CAAWI,IAAzC,EAA8C;AAAK;AACvD,oBAAG;AAAA;AAAA,kDAAaC,gBAAb,IAAiCtC,SAAS,CAAC8B,IAAV,CAAeK,EAAnD,EAAsD;AAClD;AAAA;AAAA,sDAAc3B,QAAd,CAAuB4B,gBAAvB,GAAwCpC,SAAxC;AACH;AACF;AACF;AAhC4C;AAiC/C;;AAzDuB,O;;sBAAhBb,gB,cAE+B,IAAIA,gBAAJ,E","sourcesContent":["import { HashMap } from \"../../../Utils/HashMap\";\r\nimport { TeamType2 } from \"../enums/TeamType2\";\r\nimport { instantiate, Node } from \"cc\";\r\nimport { LoadResUtil } from \"../../../Utils/LoadResUtil\";\r\nimport { DataManager } from \"../../../Managers/DataManager\";\r\nimport { CreatureManager } from \"./CreatureManager\";\r\nimport { User } from \"../../../Models/User\";\r\nimport { BattleManager } from \"./BattleManager\";\r\nimport { Creature } from \"../Enities/Creature\";\r\nimport { CreatureType } from \"../enums/CreatureType\";\r\nimport { BattleGlobal } from \"../Utils/BattleGlobal\";\r\nimport { BattleMode } from \"../enums/BattleMode\";\r\n\r\n/**\r\n * 角色管理器\r\n */\r\nexport class CharacterManager{\r\n\r\n    public static Instance:CharacterManager=new CharacterManager(); \r\n\r\n    public characterList:Array<Creature>=[];\r\n\r\n     /**\r\n     * 添加角色\r\n     * @param Creature\r\n     */\r\n    public AddCharacter(character:Creature){\r\n        this.characterList.push(character);\r\n    }\r\n\r\n    /**\r\n     * 清空\r\n     */\r\n    public Clear(){\r\n        this.characterList=[];\r\n    }\r\n\r\n    /**\r\n     * 创建角色\r\n     */ \r\n    public async CreateCharacter(teamType2:TeamType2){\r\n        let teamArr= TeamType2.Blue==teamType2 ? BattleManager.Instance.MyTeam : BattleManager.Instance.EnemyTeam;\r\n        let roomUsers= TeamType2.Blue==teamType2 ? User.Instance.room.my : User.Instance.room.enemy;\r\n        \r\n        for(let i=0;i<teamArr.length;i++){\r\n           let characterNode=teamArr[i] as Node;\r\n           if(!roomUsers[i]){\r\n             return;\r\n           }\r\n           let cId=roomUsers[i].cCharacterId;\r\n           let characterDefine = DataManager.Instance.characters[cId];\r\n\r\n           let resource=characterDefine.Resource;\r\n           console.log('cId='+cId+',resource='+resource)\r\n           let prefab= await LoadResUtil.loadPrefab(resource);\r\n           let node=instantiate(prefab) as Node; \r\n           characterNode.addChild(node);\r\n           \r\n           //创建角色\r\n           let character=new Creature(teamType2, node, characterDefine, roomUsers[i].user, CreatureType.Character);\r\n           CreatureManager.Instance.AddCreature(node, character);\r\n           CharacterManager.Instance.AddCharacter(character);\r\n           //当前角色\r\n          if(BattleGlobal.battleMode == BattleMode.Battle){    //对局模式\r\n            if(User.Instance.user.id == character.user.id){  \r\n              BattleManager.Instance.currentCharacter=character;\r\n            }\r\n          }else if(BattleGlobal.battleMode == BattleMode.Live){    //观看直播模式\r\n            if(BattleGlobal.targetLiveUserId == character.user.id){  \r\n                BattleManager.Instance.currentCharacter=character;\r\n            }\r\n          }\r\n        }\r\n     }\r\n\r\n\r\n}"]}