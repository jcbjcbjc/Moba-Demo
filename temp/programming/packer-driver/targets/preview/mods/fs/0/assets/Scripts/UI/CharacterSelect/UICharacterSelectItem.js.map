{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/CharacterSelect/UICharacterSelectItem.ts"],"names":["_decorator","Label","Sprite","SystemEventType","MessageBox","MessageBoxType","UIManager","User","LoadResUtil","EventManager","EventType","proto","ListViewItem","UserService","CharacterClass","UnLockCharacter","ccclass","property","UICharacterSelectItem","start","node","on","TOUCH_END","OnPointerClick","onClcik","console","log","state","confirmObj","Show","define","UnlockCoin","Confirm","this_","Instance","addListener","UIMessageBox_OnClickYes","SendUnLock","ID","uiCharacterDetail","show","SendCharacterDetail","user","id","tCharacterId","SetItemInfo","nameLabel","string","Name","img","spriteFrame","load_local_sprite","UpperBodyImg","unLockCharacters","isUnlock","i","length","unLockCharacter","cid","tid","unlockLabel","active","selectedLabel","character","onDestroy"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Label, Sprite, SpriteFrame, loader, resources, director, Font, Prefab, instantiate, SystemEventType } from 'cc';\r\nimport { MessageBox, MessageBoxType } from '../Common/MessageBox';\r\nimport { UIManager } from '../Common/UIManager';\r\nimport { UISystemConfig } from '../UISystemConfig';\r\nimport { User } from '../../Models/User';\r\nimport { LoadResUtil } from '../../Utils/LoadResUtil';\r\nimport { DataManager } from '../../Managers/DataManager';\r\nimport { TabView } from '../Common/TabView/TabView';\r\nimport { EventManager } from '../Common/Event/EventManager';\r\nimport { EventType } from '../Common/Event/EventType';\r\nimport { CharacterDefine } from '../../Data/CharacterDefine';\r\nimport proto from '../../../Proto/proto.js';\r\nimport { ListViewItem } from '../Common/ListView/ListViewItem';\r\nimport { UserService } from '../../Services/UserService';\r\nimport { UICharacterDetail } from '../UICharacterDetail/UICharacterDetail';\r\nimport { TipsManager } from '../TipsManager';\r\nconst { CharacterClass,UnLockCharacter }=proto;\r\nconst { ccclass, property } = _decorator;\r\n\r\n\r\n@ccclass('UICharacterSelectItem')\r\nexport class UICharacterSelectItem extends ListViewItem {\r\n\r\n    @property(Sprite)\r\n    public img=null as unknown as Sprite;\r\n    @property(Label)\r\n    public unlockLabel=null as unknown as Label;\r\n    @property(Label)\r\n    public selectedLabel=null as unknown as Label;\r\n    @property(Label)\r\n    public nameLabel=null as unknown as Label;\r\n    private define:CharacterDefine=null as unknown as CharacterDefine;\r\n     \r\n    private state:number=0; //状态 0、未解锁 1、已解锁  2、已选择 \r\n    private tCharacterId: number=0;  //已解锁数据库角色id\r\n\r\n    start (){\r\n        this.node.on(SystemEventType.TOUCH_END,this.OnPointerClick,this);\r\n    }\r\n\r\n    // public onSelected(selected:boolean):void{\r\n    //     console.log('selected='+selected)\r\n    // }\r\n    \r\n    /**\r\n     * 点击响应\r\n     */\r\n    public async onClcik():void{\r\n        console.log('onClcik')\r\n        if(this.state==0){  //未解锁\r\n           let confirmObj= await MessageBox.Show(\"确定消耗\"+this.define.UnlockCoin+\"金币解锁英雄吗？\", \"解锁英雄\", MessageBoxType.Confirm,\"确定\",\"取消\"); \r\n           let this_=this;\r\n           EventManager.Instance.addListener(EventType.UIMessageBox_OnClickYes,function(){\r\n               UserService.Instance.SendUnLock(this_.define.ID);\r\n           },confirmObj);\r\n        //    EventManager.Instance.addListener(EventType.UIMessageBox_OnClickNo,function(){\r\n        //     // console.log('取消解锁')  \r\n        //     TipsManager.Instance.showTips(\"取消解锁\");\r\n        //    },confirmObj);\r\n        }else{\r\n           let uiCharacterDetail = await UIManager.Instance.show(\"UICharacterDetail\") as UICharacterDetail;\r\n           uiCharacterDetail.SendCharacterDetail(User.Instance.user.id,this.tCharacterId);\r\n        }\r\n    }\r\n\r\n\r\n    public async SetItemInfo(define:CharacterDefine):void{\r\n        this.define=define;\r\n        this.nameLabel.string=define.Name;\r\n        this.img.spriteFrame = await LoadResUtil.load_local_sprite(define.UpperBodyImg+'/spriteFrame');\r\n        let unLockCharacters=User.Instance.user.unLockCharacters;\r\n        // console.log('unLockCharacters='+unLockCharacters)\r\n        let isUnlock:boolean=false; //是否解锁\r\n        for(let i=0;i<unLockCharacters.length;i++){\r\n            let unLockCharacter=unLockCharacters[i] as UnLockCharacter;\r\n            if(define.ID==unLockCharacter.cid){  //已解锁\r\n                isUnlock=true;\r\n                this.tCharacterId = unLockCharacter.tid;\r\n                break;\r\n            }\r\n        }\r\n        this.unlockLabel.node.active=this.selectedLabel.node.active=false;\r\n        if(User.Instance.user.character?.cid==define.ID){  //已选择\r\n            console.log('已选择')\r\n            this.selectedLabel.string='已选择';\r\n            this.selectedLabel.node.active=true;\r\n            this.unlockLabel.node.active=false;\r\n            this.state=2;\r\n            console.log('selectedLabel='+this.selectedLabel.node.active+'，unlockLabel='+this.unlockLabel.node.active)\r\n        }else if(!isUnlock){  //未解锁\r\n            this.unlockLabel.string='未解锁\\n'+define.UnlockCoin;\r\n            this.unlockLabel.node.active=true;\r\n            this.selectedLabel.node.active=false;\r\n            this.state=0;\r\n        }else{\r\n            this.state=1;\r\n        }\r\n    }\r\n\r\n    onDestroy(){\r\n        \r\n    }\r\n\r\n}\r\n"]}