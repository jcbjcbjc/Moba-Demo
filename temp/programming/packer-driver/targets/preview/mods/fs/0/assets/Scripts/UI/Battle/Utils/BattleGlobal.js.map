{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Battle/Utils/BattleGlobal.ts"],"names":["BattleGlobal","ParticleSystem","HashMap","RoomService","BattleMode","DataManager","User","proto","ChatMessage","ChatChannel","BlueScore","blueScore","UpdateBlueScore","Instance","SendUploadBiFen","redScore","RedScore","UpdateRedScore","clear","blueCart","redCart","skillTipsMap","getBattleMsgContent","chatMessage","enterFontCount","index","characterDefine","characters","fromCCharacterId","name","nameStr","battleMode","Battle","user","id","fromId","Live","enterLiveUserId","fromName","Name","contentStr","msg","i","length","char","playParticleEffect","node","active","particleSystem","getComponent","stop","play","childrenList","children"],"mappings":"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","sourcesContent":["import { Creature } from \"../Enities/Creature\";\r\nimport { HashMap } from \"../../../Utils/HashMap\";\r\nimport { RoomService } from \"../../../Services/RoomService\";\r\nimport { BattleMode } from \"../enums/BattleMode\";\r\nimport { DataManager } from \"../../../Managers/DataManager\";\r\nimport { User } from \"../../../Models/User\";\r\nimport proto from '../../../../Proto/proto.js';\r\nimport { Node, ParticleSystem } from \"cc\";\r\nconst {  ChatMessage, ChatChannel } = proto;\r\n\r\n/**\r\n * 对战变量\r\n */\r\nexport class BattleGlobal{\r\n\r\n    public static blueCart:Creature; //蓝队镖车\r\n    public static redCart:Creature;  //红队镖车\r\n    public static skillTipsMap=new HashMap();  //技能提示模型 key：技能提示类型名称字符串   value：技能模型\r\n    public static battleMode:BattleMode;  //对局模式\r\n    public static targetLiveUserId:number;  //目标直播用户id\r\n\r\n    /** 蓝队成绩 */\r\n    private static blueScore:number=0; \r\n    public static get BlueScore():number{\r\n        return this.blueScore;\r\n    }\r\n    /**\r\n     * 更新蓝队比分\r\n     */\r\n    public static UpdateBlueScore(){\r\n        this.blueScore++;\r\n        RoomService.Instance.SendUploadBiFen(this.blueScore+':'+this.redScore); //上传比分\r\n    }\r\n\r\n    /** 红队成绩 */\r\n    private static redScore:number=0; \r\n    public static get RedScore():number{\r\n        return this.redScore;\r\n    }\r\n    /**\r\n     * 更新红队比分\r\n     */\r\n    public static UpdateRedScore(){\r\n        this.redScore++;\r\n        RoomService.Instance.SendUploadBiFen(this.blueScore+':'+this.redScore); //上传比分\r\n    }\r\n\r\n    public static clear(){\r\n        this.blueScore = 0;\r\n        this.redScore = 0;\r\n        this.blueCart=null;\r\n        this.redCart=null;\r\n        this.skillTipsMap.clear();\r\n    }\r\n\r\n     /**\r\n     * 获取对战消息文本内容\r\n     * @param chatMessage 消息对象\r\n     * @param enterFontCount 换行字数  -1代表不手动换行\r\n     * @param index 0、我方  1、观看直播粉丝\r\n     */\r\n    public static getBattleMsgContent(chatMessage:ChatMessage, enterFontCount:number, index:number):string{\r\n        let characterDefine = DataManager.Instance.characters[chatMessage.fromCCharacterId];\r\n        let name = '';\r\n        let nameStr = '';\r\n        if((BattleGlobal.battleMode == BattleMode.Battle && User.Instance.user.id == chatMessage.fromId) || \r\n           (BattleGlobal.battleMode == BattleMode.Live && chatMessage.fromId == chatMessage.enterLiveUserId)) {  //自己玩家或被关注者\r\n            name = chatMessage.fromName+'('+characterDefine.Name+'):';\r\n            nameStr = '<color=#FF1493>'+name+'</color>';\r\n        }else if(index == 0){  //我方玩家\r\n            name = chatMessage.fromName+'('+characterDefine.Name+'):';\r\n            nameStr = '<color=#4169E1>'+name+'</color>';\r\n        }else if(index == 1 && BattleGlobal.battleMode == BattleMode.Battle){  //粉丝\r\n            name = '(粉丝)'+chatMessage.fromName+':';  \r\n            nameStr = '<color=#4169E1>'+name+'</color>';          \r\n        }else if(index == 1 && BattleGlobal.battleMode == BattleMode.Live){  //游客\r\n            name = '(游客)'+chatMessage.fromName+':';  \r\n            nameStr = '<color=#4169E1>'+name+'</color>';       \r\n        }\r\n        \r\n        let contentStr='';\r\n      if(enterFontCount < 0){\r\n        contentStr = chatMessage.msg;\r\n      } else {\r\n        let i=name.length;\r\n        for(let char of chatMessage.msg){\r\n            i++;\r\n            if(i%enterFontCount==0){  //换行\r\n                char += '\\n';\r\n            }\r\n            contentStr += char;\r\n        }\r\n      }\r\n       // console.log('contentStr='+contentStr)\r\n        return nameStr+'<color=#ffffff>'+contentStr+'</color>';\r\n    }\r\n\r\n    /**\r\n     * 播放粒子特效\r\n     */\r\n    public static playParticleEffect(node : Node){\r\n        node.active = true;\r\n        let particleSystem = node.getComponent(ParticleSystem);\r\n        if(particleSystem){\r\n            particleSystem.stop();\r\n            particleSystem.clear();\r\n            particleSystem.play();\r\n            // particleSystem.pause();\r\n            // particleSystem.play();\r\n        }\r\n        let childrenList = node.children;\r\n        for(let i=0; i < childrenList.length; i++){\r\n            this.playParticleEffect(childrenList[i]);\r\n        }\r\n    }\r\n\r\n}"]}