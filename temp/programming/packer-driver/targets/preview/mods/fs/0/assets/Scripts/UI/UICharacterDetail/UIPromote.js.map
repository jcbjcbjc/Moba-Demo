{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/UICharacterDetail/UIPromote.ts"],"names":["_decorator","Label","EventManager","EventType","User","UserService","UIWindow","DataUtil","proto","ccclass","property","AttrPromoteType","AddAttrType","AttrPromoteInfoResponse","UIPromote","start","Instance","addListener","OnAttrPromoteInfo_UI","SetPromoteDetail","tCharacterId","attrPromoteType","spot","uiCharacterDetail","console","log","UpdateAttrPromoteInfo","attrStr","addAttrDefine","queryObjAddAttrByType","GEM","cgjhStr","Probability","Att","Def","Hp","Cri","Resu","Speed","Cd","attrLabel","string","cgjhLabel","AttrPromote","SendAttrPromote","param","attrPromoteInfoResponse","user","character","tid","UpdateAttrPromote","attrValue","onDestroy","removeAll"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, Label } from 'cc';\r\nimport { EventManager } from '../Common/Event/EventManager';\r\nimport { EventType } from '../Common/Event/EventType';\r\nimport { User } from '../../Models/User';\r\nimport { UserService } from '../../Services/UserService';\r\nimport { UIWindow } from '../Common/UIWindow';\r\nimport { DataManager } from '../../Managers/DataManager';\r\nimport { DataUtil } from '../../Utils/DataUtil';\r\nimport proto from '../../../Proto/proto.js';\r\nimport { UICharacterDetail } from './UICharacterDetail';\r\nconst { ccclass, property } = _decorator;\r\nconst { AttrPromoteType, AddAttrType, AttrPromoteInfoResponse }=proto;\r\n\r\n@ccclass('UIPromote')\r\nexport class UIPromote extends UIWindow {\r\n\r\n    @property(Label)\r\n    public attrLabel=null as unknown as Label;\r\n    @property(Label)\r\n    public cgjhLabel=null as unknown as Label;\r\n\r\n    private tCharacterId: number=0;   //数据库角色id\r\n    private attrPromoteType:AttrPromoteType=null as unknown as AttrPromoteType;  //提升类型\r\n    private spot:number=0;  //点数\r\n    private uiCharacterDetail:UICharacterDetail=null as unknown as UICharacterDetail;\r\n \r\n    start () {\r\n        EventManager.Instance.addListener(EventType.OnAttrPromoteInfo_UI,this.OnAttrPromoteInfo_UI,this); \r\n    }\r\n    \r\n    /**\r\n     * 设置提升属性信息\r\n     */\r\n    public SetPromoteDetail(tCharacterId: number, attrPromoteType:AttrPromoteType,spot:number,uiCharacterDetail:UICharacterDetail){\r\n        console.log('SetPromoteDetail tCharacterId='+tCharacterId+'，attrPromoteType='+attrPromoteType+'，spot='+spot)\r\n        this.tCharacterId=tCharacterId;\r\n        this.attrPromoteType=attrPromoteType;\r\n        this.spot=spot;\r\n        this.uiCharacterDetail=uiCharacterDetail;\r\n        this.UpdateAttrPromoteInfo();\r\n    }\r\n\r\n    /**\r\n     * 更新提升属性信息\r\n     */\r\n    private UpdateAttrPromoteInfo(){ \r\n        let attrStr='';  //属性信息\r\n       let addAttrDefine = DataUtil.queryObjAddAttrByType(AddAttrType.GEM,this.spot);\r\n       let cgjhStr='';//成功机会信息\r\n       if(addAttrDefine){ \r\n           cgjhStr='成功机会：'+addAttrDefine.Probability+'%';   \r\n       }else{\r\n           cgjhStr='成功机会：0%';\r\n       }\r\n\r\n       if(this.attrPromoteType==AttrPromoteType.Att){\r\n          attrStr='攻击：';\r\n       }else if(this.attrPromoteType==AttrPromoteType.Def){\r\n          attrStr='防御：';\r\n       }else if(this.attrPromoteType==AttrPromoteType.Hp){\r\n          attrStr='血量：';\r\n       }else if(this.attrPromoteType==AttrPromoteType.Cri){\r\n          attrStr='暴击率：';\r\n       }else if(this.attrPromoteType==AttrPromoteType.Resu){\r\n          attrStr='复活率：';\r\n       }else if(this.attrPromoteType==AttrPromoteType.Speed){\r\n          attrStr='速度：';\r\n       }else if(this.attrPromoteType==AttrPromoteType.Cd){\r\n          attrStr='cd：';\r\n       }\r\n\r\n       this.attrLabel.string=attrStr+this.spot;\r\n       this.cgjhLabel.string=cgjhStr;\r\n    }\r\n\r\n    /**\r\n     * 请求属性提升\r\n     */\r\n    public AttrPromote():void{\r\n        UserService.Instance.SendAttrPromote(this.tCharacterId,this.attrPromoteType);\r\n    }\r\n\r\n    /**\r\n     * 属性提升响应\r\n     */\r\n    private OnAttrPromoteInfo_UI(param:any){\r\n        let attrPromoteInfoResponse = param[0] as AttrPromoteInfoResponse;\r\n          //更新已选角色属性\r\n        if(User.Instance.user.character?.tid==this.tCharacterId){\r\n            User.Instance.UpdateAttrPromote(this.attrPromoteType,attrPromoteInfoResponse.spot,attrPromoteInfoResponse.attrValue);\r\n        }\r\n        this.spot=attrPromoteInfoResponse.spot;\r\n        this.UpdateAttrPromoteInfo();\r\n        //更新详情界面属性提升\r\n        if(this.uiCharacterDetail){\r\n            this.uiCharacterDetail.UpdateAttrPromote(this.attrPromoteType,attrPromoteInfoResponse);\r\n        }\r\n    }\r\n\r\n    onDestroy(){\r\n        EventManager.Instance.removeAll(this);\r\n    }\r\n\r\n}\r\n"]}