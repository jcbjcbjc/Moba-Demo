{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Battle/Effects/EntityEffectManager.ts"],"names":["_decorator","Node","Component","EffectType","HashMap","EffectController","BattleManager","GlobalPool","BattleGlobal","ccclass","property","EntityEffectManager","start","Effects","clear","children","Root","length","i","node","put","name","Props","PlayEffect3","console","log","get","playParticleEffect","PlayEffect2","type","target","pos","duration","Bullet","effect","InstantiateEffect","Init","PlayEffectBulletRealCheck","bullet","BulletRealCheck","effectsNameStr","keys","join","InitBulletRealCheck","prefab","createPool","go","Instance","AllBattleEffectsNode","addChild","worldPosition","worldRotation","getComponent","Array"],"mappings":"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","sourcesContent":["import { _decorator, instantiate, Node, Component, Vec3, AnimationComponent, Prefab, UITransform, Vec2 } from 'cc';\r\nimport { EffectType } from './EffectType';\r\nimport { HashMap } from '../../../Utils/HashMap';\r\nimport { EffectController } from './EffectController';\r\nimport { BattleManager } from '../Managers/BattleManager';\r\nimport { Bullet } from '../Models/Bullet';\r\nimport GlobalPool from '../../../Utils/GlobalPool';\r\nimport { BattleGlobal } from '../Utils/BattleGlobal';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('EntityEffectManager')\r\nexport class EntityEffectManager extends Component{\r\n\r\n    @property(Node)\r\n    public Root:Node;\r\n    @property([Node])\r\n    public Props=new Array<Node>();\r\n    \r\n    //key=>name  value=>node\r\n    private Effects = new HashMap();\r\n\r\n    public start()\r\n    {\r\n        this.Effects.clear();\r\n\r\n        let children = this.Root.children;\r\n        if(this.Root !=null && children.length > 0)\r\n        {\r\n            for(let i = 0; i < children.length; i++)\r\n            {\r\n                let node = children[i];\r\n                this.Effects.put(node.name, node);\r\n            }\r\n        }\r\n        if(this.Props != null)\r\n        {\r\n            for (let i = 0; i < this.Props.length; i++)\r\n            {\r\n                let node = this.Props[i];\r\n                this.Effects.put(node.name, node)\r\n            }\r\n        }\r\n    }\r\n\r\n    public PlayEffect3(name:string)\r\n    {\r\n        console.log(\"PlayEffect3:{0}:{1}\", this.name, name);\r\n        let node=this.Effects.get(name) as Node;\r\n        if (node)\r\n        {\r\n            // node.active=true;\r\n            BattleGlobal.playParticleEffect(node);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 子弹类型特效\r\n     */\r\n    public PlayEffect2(type:EffectType,  name:string, target:Node, pos:Vec3, duration:number)\r\n    {\r\n        if (type == EffectType.Bullet)\r\n        {\r\n            let effect = this.InstantiateEffect(name);\r\n            if(!effect){\r\n                console.log('not find prefab')\r\n                return;\r\n            }\r\n            effect.Init(type, this.node, target, pos, duration);\r\n            // effect.node.active = true;\r\n            BattleGlobal.playParticleEffect(effect.node);\r\n        }\r\n        else\r\n            this.PlayEffect3(name);\r\n    }\r\n\r\n    public PlayEffectBulletRealCheck(type:EffectType, name:string, bullet:Bullet)\r\n    {\r\n        if (type == EffectType.BulletRealCheck)\r\n        {\r\n            let effect = this.InstantiateEffect(name);\r\n            if(!effect){\r\n                let effectsNameStr = this.Effects.keys().join('，');\r\n                console.log('not find prefab name='+name+'，effectsNameStr='+effectsNameStr)\r\n                return;\r\n            }\r\n            effect.InitBulletRealCheck(type, bullet);\r\n            // effect.node.active = true;\r\n            BattleGlobal.playParticleEffect(effect.node);\r\n        }\r\n    }\r\n\r\n    public InstantiateEffect(name:string):EffectController\r\n    {\r\n        console.log('EntityEffectManager InstantiateEffect name='+name)\r\n        let prefab = this.Effects.get(name) as Node;\r\n        if(prefab)\r\n        {\r\n            //创建对象池\r\n            GlobalPool.createPool(name, prefab);\r\n            //获取对象实例\r\n            let go = GlobalPool.get(name);\r\n            // let go = instantiate(prefab) as Node;\r\n            BattleManager.Instance.AllBattleEffectsNode.addChild(go);\r\n            go.worldPosition = prefab.worldPosition;\r\n            go.worldRotation = prefab.worldRotation;\r\n            return go.getComponent(EffectController);\r\n        }\r\n        return null;\r\n    }\r\n}"]}