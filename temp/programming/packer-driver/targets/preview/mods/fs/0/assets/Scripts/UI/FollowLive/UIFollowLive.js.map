{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/FollowLive/UIFollowLive.ts"],"names":["_decorator","Component","director","Prefab","TabView","EventManager","EventType","proto","UIFollowLiveItem","ListView","FollowManager","List","FollowService","CharacterClass","UserStatus","ccclass","property","UIFollowLive","start","tab","owner","listMain","isAddScene","Instance","addListener","FollowListRefieshUI","SendFollowList","TabView_OnTabSelect","OnTabSelect","RefreshUI","console","log","ClearList","follows","followList","i","length","follow","index","status","userStatus","Game","push","followLiveList","numItems","param","RemoveAll","back","loadScene","OnFollowLiveListRender","node","uiFollowLiveItem","getComponent","AddItem","SetItemInfo","onDestroy","removeAll"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, Label, Sprite, SpriteFrame, loader, resources, director, Font, Prefab, instantiate } from 'cc';\r\nimport { MessageBox } from '../Common/MessageBox';\r\nimport { UIManager } from '../Common/UIManager';\r\nimport { UISystemConfig } from '../UISystemConfig';\r\nimport { User } from '../../Models/User';\r\nimport { LoadResUtil } from '../../Utils/LoadResUtil';\r\nimport { DataManager } from '../../Managers/DataManager';\r\nimport { TabView } from '../Common/TabView/TabView';\r\nimport { EventManager } from '../Common/Event/EventManager';\r\nimport { EventType } from '../Common/Event/EventType';\r\nimport { CharacterDefine } from '../../Data/CharacterDefine';\r\nimport proto from '../../../Proto/proto.js';\r\nimport { UIFollowLiveItem } from './UIFollowLiveItem';\r\nimport { ListView } from '../Common/ListView/ListView';\r\nimport { ListViewItem } from '../Common/ListView/ListViewItem';\r\nimport { FollowManager } from '../../Managers/FollowManager';\r\nimport List from '../Common/ScrollView/List';\r\nimport { FollowService } from '../../Services/FollowService';\r\nconst { CharacterClass, UserStatus }=proto;\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * 关注直播\r\n */\r\n@ccclass('UIFollowLive')\r\nexport class UIFollowLive extends Component {\r\n\r\n    @property(List) \r\n    private followLiveList = null as unknown as List;\r\n    @property(TabView)\r\n    public tab:TabView=null as unknown as TabView;\r\n    @property(Prefab)\r\n    public itemPrefab:Prefab=null as unknown as Prefab;\r\n    @property(ListView)\r\n    public listMain:ListView=null as unknown as ListView;\r\n    private followList:Array<any> = [];\r\n    \r\n    private index:number=-1;  //选择索引\r\n    start () { \r\n        this.tab.owner=this;\r\n        this.listMain.isAddScene=false;\r\n        EventManager.Instance.addListener(EventType.FollowListRefieshUI,this.FollowListRefieshUI,this);\r\n        FollowService.Instance.SendFollowList();\r\n    }\r\n    \r\n    /**\r\n     * 关注数据响应\r\n     */\r\n    private FollowListRefieshUI(){\r\n        EventManager.Instance.addListener(EventType.TabView_OnTabSelect,this.OnTabSelect,this);\r\n    }\r\n\r\n    /**\r\n     * 刷新UI\r\n     */\r\n    public RefreshUI(){\r\n        console.log('RefreshUI')\r\n        \r\n        this.ClearList();\r\n        //获取对应索引\r\n       let follows=FollowManager.Instance.follows;\r\n\r\n       this.followList = [];\r\n       for(let i=0;i<follows.length;i++){\r\n        let follow=follows[i];\r\n        if(this.index==0){  //直播中\r\n            if(!follow.status || follow.userStatus != UserStatus.Game){  //离线或非游戏状态\r\n                continue;\r\n            }\r\n        }else if(this.index==1){  //在线\r\n            if(!follow.status || follow.userStatus == UserStatus.Game){  //离线或游戏状态\r\n                continue;\r\n            }\r\n        }else if(this.index==2){  //离线\r\n            if(follow.status || follow.userStatus == UserStatus.Game){  //在线或游戏状态\r\n                continue;\r\n            }\r\n        }\r\n        this.followList.push(follow);\r\n       }\r\n       this.followLiveList.numItems=this.followList.length;\r\n    }\r\n\r\n    /**\r\n     * 切换选择\r\n     * @param param 索引\r\n     */\r\n    private OnTabSelect(param:any){\r\n        let index=param[0];\r\n        if(this.index==index){\r\n            return;\r\n        }\r\n        this.index=index;\r\n        console.log('OnTabSelect index='+this.index,this)\r\n       this.RefreshUI();\r\n    }\r\n\r\n    private ClearList():void\r\n    {\r\n        this.listMain.RemoveAll();\r\n    }\r\n\r\n\r\n    /**\r\n     * 返回\r\n     */\r\n    back(){\r\n        director.loadScene('UIMain');\r\n    }\r\n\r\n    /**\r\n     * 关注/直播列表渲染\r\n     * @param node\r\n     * @param index \r\n     */\r\n    OnFollowLiveListRender(node: Node, index: number) {\r\n        let uiFollowLiveItem=node.getComponent(UIFollowLiveItem) ;\r\n        this.listMain.AddItem(node,uiFollowLiveItem as ListViewItem);\r\n        uiFollowLiveItem?.SetItemInfo(this.followList[index], this.index);\r\n    }\r\n    \r\n    onDestroy(){\r\n        console.log('onDestroy')\r\n        EventManager.Instance.removeAll(this);\r\n    }\r\n\r\n}\r\n"]}