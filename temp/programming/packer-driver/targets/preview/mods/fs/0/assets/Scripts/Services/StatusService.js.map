{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/Services/StatusService.ts"],"names":["StatusService","proto","EventManager","EventType","User","ItemManager","NetMessage","NetMessageRequest","Result","NStatus","StatusNotify","StatusType","StatusAction","Init","Instance","addListener","OnStatusNotify","param","response","i","status","length","Notify","console","info","type","action","id","value","MONEY","ADD","AddGold","DELETE","ITEM","AddItem","RemoveItem","UPDATE","UpdateBagItemCount"],"mappings":";;;iFAcaA,a;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAbNC,MAAAA,K;;AAGEC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,S,iBAAAA,S;;AAEAC,MAAAA,I,iBAAAA,I;;AAIAC,MAAAA,W,iBAAAA,W;;;;;;;OACH;AAAEC,QAAAA,UAAF;AAAcC,QAAAA,iBAAd;AAAiCC,QAAAA,MAAjC;AAAyCC,QAAAA,OAAzC;AAAkDC,QAAAA,YAAlD;AAAgEC,QAAAA,UAAhE;AAA4EC,QAAAA;AAA5E,O;;;;+BAEOZ,a,GAAN,MAAMA,aAAN,CAAmB;AAGfa,QAAAA,IAAI,GAAG;AACV;AAAA;AAAA,4CAAaC,QAAb,CAAsBC,WAAtB,CAAkC;AAAA;AAAA,sCAAUC,cAA5C,EAA4D,KAAKA,cAAjE,EAAiF,IAAjF;AACH;;AAGOA,QAAAA,cAAc,CAACC,KAAD,EAAiB;AACnC,cAAIC,QAAQ,GAAGD,KAAK,CAAC,CAAD,CAApB;;AACA,eAAI,IAAIE,CAAC,GAAC,CAAV,EAAaA,CAAC,GAAGD,QAAQ,CAACE,MAAT,CAAgBC,MAAjC,EAAyCF,CAAC,EAA1C,EAA6C;AACzC,gBAAIC,MAAM,GAACF,QAAQ,CAACE,MAAT,CAAgBD,CAAhB,CAAX;AACA,iBAAKG,MAAL,CAAYF,MAAZ;AACH;AACJ;;AAEOE,QAAAA,MAAM,CAACF,MAAD,EAAqB;AAC/BG,UAAAA,OAAO,CAACC,IAAR,CAAa,gCAAb,EAA8CJ,MAAM,CAACK,IAArD,EAA2DL,MAAM,CAACM,MAAlE,EAA0EN,MAAM,CAACO,EAAjF,EAAqFP,MAAM,CAACQ,KAA5F;;AACA,cAAIR,MAAM,CAACK,IAAP,IAAed,UAAU,CAACkB,KAA9B,EAAoC;AAAG;AACnC,gBAAIT,MAAM,CAACM,MAAP,IAAiBd,YAAY,CAACkB,GAAlC,EACI;AAAA;AAAA,8BAAKhB,QAAL,CAAciB,OAAd,CAAsBX,MAAM,CAACQ,KAA7B,EADJ,KAEK,IAAGR,MAAM,CAACM,MAAP,IAAiBd,YAAY,CAACoB,MAAjC,EACD;AAAA;AAAA,8BAAKlB,QAAL,CAAciB,OAAd,CAAsB,CAACX,MAAM,CAACQ,KAA9B;AACP,WALD,MAKM,IAAGR,MAAM,CAACK,IAAP,IAAed,UAAU,CAACsB,IAA7B,EAAkC;AAAG;AACvC,gBAAIb,MAAM,CAACM,MAAP,IAAiBd,YAAY,CAACkB,GAAlC,EAAsC;AAAG;AACrC;AAAA;AAAA,8CAAYhB,QAAZ,CAAqBoB,OAArB,CAA6Bd,MAAM,CAACO,EAApC,EAAuCP,MAAM,CAACQ,KAA9C;AACH,aAFD,MAEM,IAAGR,MAAM,CAACM,MAAP,IAAiBd,YAAY,CAACoB,MAAjC,EAAwC;AAAG;AAC7C;AAAA;AAAA,8CAAYlB,QAAZ,CAAqBqB,UAArB,CAAgCf,MAAM,CAACO,EAAvC,EAA0CP,MAAM,CAACQ,KAAjD;AACH,aAFK,MAEA,IAAGR,MAAM,CAACM,MAAP,IAAiBd,YAAY,CAACwB,MAAjC,EAAwC;AAAG;AAC7C;AAAA;AAAA,8CAAYtB,QAAZ,CAAqBuB,kBAArB,CAAwCjB,MAAM,CAACO,EAA/C,EAAkDP,MAAM,CAACQ,KAAzD;AACH;AACJ;AACJ;;AAhCqB,O;;sBAAb5B,a,cAC+B,IAAIA,aAAJ,E","sourcesContent":["import { LogUtil } from \"../Log/LogUtil\";\r\nimport proto from '../../Proto/proto.js';\r\nimport { NetClient } from \"../Network/NetClient\";\r\nimport { MessageBox, MessageBoxType } from \"../UI/Common/MessageBox\";\r\nimport { EventManager } from \"../UI/Common/Event/EventManager\";\r\nimport { EventType } from \"../UI/Common/Event/EventType\";\r\nimport { SocketConst } from \"../Network/SocketConst\";\r\nimport { User } from \"../Models/User\";\r\nimport { director } from \"cc\";\r\nimport { SoundManager } from \"../../Sound/SoundManager\";\r\nimport { SoundDefine } from \"../../Sound/SoundDefine\";\r\nimport { ItemManager } from \"../Managers/ItemManager\";\r\nconst { NetMessage, NetMessageRequest, Result, NStatus, StatusNotify, StatusType, StatusAction } = proto;\r\n\r\nexport class StatusService{\r\n    public static Instance: StatusService = new StatusService();\r\n\r\n    public Init() {\r\n        EventManager.Instance.addListener(EventType.OnStatusNotify, this.OnStatusNotify, this)\r\n    }\r\n\r\n\r\n    private OnStatusNotify(param: any):void{\r\n        let response = param[0] as StatusNotify;\r\n        for(let i=0; i < response.status.length; i++){\r\n            let status=response.status[i] as NStatus;\r\n            this.Notify(status);\r\n        }\r\n    }\r\n\r\n    private Notify(status:NStatus):void{\r\n        console.info(\"StatusNotify:[{0}][{1}]{2}:{3}\",status.type, status.action, status.id, status.value);\r\n        if (status.type == StatusType.MONEY){  //金币变更\r\n            if (status.action == StatusAction.ADD)\r\n                User.Instance.AddGold(status.value);\r\n            else if(status.action == StatusAction.DELETE)\r\n                User.Instance.AddGold(-status.value);\r\n        }else if(status.type == StatusType.ITEM){  //道具变更  \r\n            if (status.action == StatusAction.ADD){  //加道具\r\n                ItemManager.Instance.AddItem(status.id,status.value);\r\n            }else if(status.action == StatusAction.DELETE){  //删道具\r\n                ItemManager.Instance.RemoveItem(status.id,status.value);\r\n            }else if(status.action == StatusAction.UPDATE){  //更新道具\r\n                ItemManager.Instance.UpdateBagItemCount(status.id,status.value);\r\n            }\r\n        }\r\n    }\r\n\r\n    \r\n}"]}