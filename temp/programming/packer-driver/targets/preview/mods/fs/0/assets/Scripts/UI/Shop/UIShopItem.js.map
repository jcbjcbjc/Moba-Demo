{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Shop/UIShopItem.ts"],"names":["_decorator","Label","Sprite","SystemEventType","SpriteFrame","ListViewItem","EventManager","DataManager","LoadResUtil","ccclass","property","UIShopItem","onLoad","node","on","TOUCH_END","OnPointerClick","nodeBgSprite","getComponent","normalBgSpriteFrame","spriteFrame","onSelected","selected","selectBgSpriteFrame","uiShopDetailItem","SetItemInfo","itemDefine","shopItemDefine","index","uiShop","selectedIndex","Instance","items","ItemID","id","ID","nameLabel","string","Name","Count","priceLabel","Price","imgSprite","load_local_sprite","Icon","onDestroy","console","log","removeAll"],"mappings":"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","sourcesContent":["import { ListViewItem } from \"../Common/ListView/ListViewItem\";\r\n\r\nimport { _decorator, Component, Node, Prefab, Label, Sprite, SystemEventType, SpriteFrame } from 'cc';\r\nimport { UIWindow } from '../Common/UIWindow';\r\nimport { User } from '../../Models/User';\r\nimport { NItem } from '../../../Proto/proto';\r\nimport { EventManager } from \"../Common/Event/EventManager\";\r\nimport { ListView } from \"../Common/ListView/ListView\";\r\nimport { DataManager } from \"../../Managers/DataManager\";\r\nimport { LoadResUtil } from \"../../Utils/LoadResUtil\";\r\nimport { UIShopDetailItem } from \"./UIShopDetailItem\";\r\nimport { UIShop } from \"./UIShop\";\r\nimport { ShopItemDefine } from \"../../Data/ShopItemDefine\";\r\nimport { ItemDefine } from \"../../Data/ItemDefine\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('UIShopItem')\r\nexport class UIShopItem extends ListViewItem {\r\n \r\n    @property(Label)\r\n    public countLabel=null as unknown as Label;\r\n    @property(Label)\r\n    public nameLabel=null as unknown as Label;\r\n    @property(Sprite)\r\n    public imgSprite=null as unknown as Sprite;\r\n    @property(Label)\r\n    public priceLabel=null as unknown as Label;\r\n    @property(SpriteFrame)\r\n    public selectBgSpriteFrame=null as unknown as SpriteFrame;\r\n\r\n    public normalBgSpriteFrame=null as unknown as SpriteFrame;\r\n    private nodeBgSprite:Sprite=null as unknown as Sprite;\r\n    public shopItemDefine=null as unknown as ShopItemDefine;\r\n    public uiShopDetailItem=null as unknown as UIShopDetailItem;\r\n    private index:number=0;\r\n    private uiShop=null as unknown as UIShop; \r\n    public itemDefine=null as unknown as ItemDefine;\r\n    public id:number;  //唯一标识\r\n\r\n    onLoad () {\r\n      // if(this.index==0){\r\n      //   console.log('onLoad index='+this.index)\r\n      // }\r\n      this.node.on(SystemEventType.TOUCH_END,this.OnPointerClick,this);\r\n      this.nodeBgSprite=this.node.getComponent(Sprite) as Sprite;\r\n      this.normalBgSpriteFrame = this.nodeBgSprite.spriteFrame as SpriteFrame;\r\n    }\r\n\r\n    public async onSelected(selected:boolean):void{\r\n      // if(this.index==0){\r\n        // console.log('onSelected index='+this.index+'，selected='+selected)\r\n      // }\r\n        if(this.nodeBgSprite){\r\n           this.nodeBgSprite.spriteFrame = selected ? this.selectBgSpriteFrame : this.normalBgSpriteFrame;\r\n        }\r\n        if(selected){  //选中，更新右边详细\r\n          await this.uiShopDetailItem.SetItemInfo(this.itemDefine, this.shopItemDefine,this.index, this.uiShop);\r\n           this.uiShop.selectedIndex=this.index;\r\n        }\r\n    }\r\n\r\n    public async SetItemInfo(shopItemDefine:ShopItemDefine,uiShopDetailItem:UIShopDetailItem,selected:boolean=false,index:number=-1,uiShop:UIShop){\r\n      this.shopItemDefine=shopItemDefine;\r\n      if(index != -1){\r\n        this.index=index;\r\n      }\r\n      this.uiShop=uiShop;\r\n      this.uiShopDetailItem=uiShopDetailItem;\r\n      this.itemDefine= DataManager.Instance.items[shopItemDefine.ItemID];\r\n      this.id = this.itemDefine.ID;\r\n      //  this.countLabel.string=shopItemDefine.Count+'';\r\n       this.nameLabel.string=this.itemDefine.Name+'x'+shopItemDefine.Count;\r\n       this.priceLabel.string=shopItemDefine.Price+'';\r\n       this.imgSprite.spriteFrame=await LoadResUtil.load_local_sprite(this.itemDefine.Icon+'/spriteFrame');\r\n       if(selected){\r\n        this.OnPointerClick();\r\n       }\r\n       \r\n    }\r\n\r\n\r\n    onDestroy(){\r\n        console.log('onDestroy')\r\n        EventManager.Instance.removeAll(this);\r\n    }\r\n}"]}