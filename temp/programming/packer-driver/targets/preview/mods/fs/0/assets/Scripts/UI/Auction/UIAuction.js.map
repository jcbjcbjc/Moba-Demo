{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Auction/UIAuction.ts"],"names":["_decorator","Prefab","Button","UIWindow","proto","EventManager","ListView","UIAuctionItem","UIAuctionDetailItem","EventType","MessageBox","AuctionService","InputBox","Validate","UIManager","List","ccclass","property","NItem","Result","NAuctionItem","UIAuction","start","listMain","owner","isAddScene","Instance","addListener","ListView_OnItemSelected","OnItemSelected","OnGetAuctionList_UI","AuctionRefreshUI","OnOfferPrice","OnAuction_UI","RefieshUI","this_","timer","setInterval","param","uiAuctionItem","console","log","itemDefine","OnClickOfferPrice","Show","item","confirmInputOfferPriceObj","UIInputBox_OnClickYes","money","isIntegerLarge0","SendOfferPrice","id","parseInt","Close","confirmInputCoinObj","uiBag","OnClickAuction","show","SetUpOpenMode","UIBag_OnClickSelected","itemId","param2","SendAuction","SendGetAuctionList","ClearList","auctionItemList","length","uiAuctionDetailItem","node","active","auctionList","numItems","RemoveAll","OnAuctionListRender","index","getComponent","AddItem","SetItemInfo","selectedIndex","onDestroy","removeListener","removeAll","clearInterval"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, Prefab, instantiate, Button } from 'cc';\r\nimport { UIWindow } from '../Common/UIWindow';\r\nimport { User } from '../../Models/User';\r\nimport proto from '../../../Proto/proto.js';\r\nimport { EventManager } from '../Common/Event/EventManager';\r\nimport { ListView } from '../Common/ListView/ListView';\r\nimport { UIAuctionItem } from './UIAuctionItem';\r\nimport { ListViewItem } from '../Common/ListView/ListViewItem';\r\nimport { UIAuctionDetailItem } from './UIAuctionDetailItem';\r\nimport { EventType } from '../Common/Event/EventType';\r\nimport { TabView } from '../Common/TabView/TabView';\r\nimport { DataManager } from '../../Managers/DataManager';\r\nimport { MessageBox, MessageBoxType } from '../Common/MessageBox';\r\nimport { ItemService } from '../../Services/ItemService';\r\nimport { AuctionService } from '../../Services/AuctionService';\r\nimport { InputBox } from '../Common/InputBox';\r\nimport { Validate } from '../../Utils/Validate';\r\nimport { UIManager } from '../Common/UIManager';\r\nimport { UIBag } from '../Bag/UIBag';\r\nimport List from '../Common/ScrollView/List';\r\nimport { UIInputBox } from '../Common/UIInputBox';\r\nconst { ccclass, property } = _decorator;\r\nconst { NItem, Result,NAuctionItem } = proto;\r\n\r\n@ccclass('UIAuction')\r\nexport class UIAuction extends UIWindow {\r\n \r\n    @property(List) \r\n    private auctionList = null as unknown as List;\r\n    @property(Prefab)\r\n    public itemPrefab:Prefab=null as unknown as Prefab;\r\n    @property(ListView)\r\n    public listMain:ListView=null as unknown as ListView;\r\n    @property(UIAuctionDetailItem)\r\n    public uiAuctionDetailItem=null as unknown as UIAuctionDetailItem;\r\n    @property(Button)\r\n    public offerPriceButton=null as unknown as Button;  \r\n    @property(Button)\r\n    public auctionButton=null as unknown as Button;  \r\n    public selectedIndex:number=0;\r\n    private timer:number=0;\r\n\r\n    private uiAuctionItem:UIAuctionItem=null as unknown as UIAuctionItem;\r\n    private uiBag=null as unknown as UIBag;  \r\n    private auctionItemList:Array<NAuctionItem>=[];\r\n    private confirmInputCoinObj:UIInputBox=null;   //拍卖金额框\r\n    private confirmInputOfferPriceObj:UIInputBox=null;   //出价金额框\r\n \r\n    start () {\r\n        this.listMain.owner=this;\r\n        this.listMain.isAddScene=false;\r\n        EventManager.Instance.addListener(EventType.ListView_OnItemSelected,this.OnItemSelected,this);\r\n        EventManager.Instance.addListener(EventType.OnGetAuctionList_UI,this.OnGetAuctionList_UI,this); \r\n        EventManager.Instance.addListener(EventType.AuctionRefreshUI,this.OnOfferPrice,this);\r\n        EventManager.Instance.addListener(EventType.OnAuction_UI,this.OnAuction_UI,this);\r\n        \r\n        this.RefieshUI(); \r\n        let this_=this;\r\n        this.timer=setInterval(function(){\r\n            this_.RefieshUI();\r\n        },5000);\r\n    }\r\n\r\n    private OnItemSelected(param:any){\r\n        this.uiAuctionItem=param[0] as UIAuctionItem;\r\n        console.log('OnItemSelected='+this.uiAuctionItem.itemDefine)\r\n    }\r\n\r\n    /**\r\n     * 点击出价\r\n     */\r\n    public async OnClickOfferPrice(){\r\n        if (!this.uiAuctionItem){\r\n            MessageBox.Show(\"请选择要出价的道具\",\"出价\");\r\n            return;\r\n        }\r\n        let item=this.uiAuctionItem.item;\r\n      \r\n        this.confirmInputOfferPriceObj = await InputBox.Show('请输入出价金额',\"出价\");\r\n       EventManager.Instance.addListener(EventType.UIInputBox_OnClickYes,function(param:any):string{\r\n         let money=param[0];\r\n         if(!Validate.isIntegerLarge0(money)){\r\n           return '出价金额必须大于0';\r\n         }\r\n          AuctionService.Instance.SendOfferPrice(item.id,  parseInt(money)); \r\n         return '';\r\n        }, this.confirmInputOfferPriceObj);\r\n        \r\n     }\r\n\r\n     /**\r\n      * 出价响应\r\n      */\r\n     private OnOfferPrice(){\r\n        this.RefieshUI(); \r\n         if(this.confirmInputOfferPriceObj){\r\n            this.confirmInputOfferPriceObj.Close();\r\n         }\r\n     }\r\n\r\n     /**\r\n      * 拍卖响应\r\n      */\r\n     private OnAuction_UI(){\r\n         console.log('OnAuction_UI confirmInputCoinObj='+this.confirmInputCoinObj)\r\n        this.RefieshUI(); \r\n        if(this.uiBag){\r\n           this.uiBag.Close();\r\n        }\r\n        if(this.confirmInputCoinObj){\r\n           this.confirmInputCoinObj.Close();\r\n        }\r\n     }\r\n\r\n\r\n    /**\r\n     * 点击拍卖\r\n     */\r\n    public async OnClickAuction(){\r\n        this.uiBag = await UIManager.Instance.show(\"UIBag\") as UIBag;\r\n        this.uiBag.SetUpOpenMode(2, this);\r\n        EventManager.Instance.addListener(EventType.UIBag_OnClickSelected,this.UIBag_OnClickSelected,this);\r\n    }\r\n\r\n    /**\r\n     * 背包物品选择\r\n     * @param param \r\n     */\r\n    private async UIBag_OnClickSelected(param:any){\r\n        let itemId=param[0];\r\n        this.confirmInputCoinObj = await InputBox.Show('请输入拍卖金额',\"拍卖\");\r\n        EventManager.Instance.addListener(EventType.UIInputBox_OnClickYes,function(param2:any):string{\r\n          let money=param2[0];\r\n          if(!Validate.isIntegerLarge0(money)){\r\n            return '拍卖金额必须大于0';\r\n          }\r\n           AuctionService.Instance.SendAuction(itemId,  parseInt(money)); \r\n          return '';\r\n         },this.confirmInputCoinObj);\r\n    }\r\n\r\n\r\n    public RefieshUI(){\r\n        AuctionService.Instance.SendGetAuctionList();\r\n\r\n    }\r\n    \r\n\r\n    /**\r\n     * 查询拍卖大厅响应\r\n     * @param param \r\n     */\r\n    private OnGetAuctionList_UI(param: any){\r\n        this.ClearList();\r\n        this.auctionItemList = param[0] as Array<NAuctionItem>;\r\n        // console.log('OnGetAuctionList_UI：'+auctionItems)\r\n        if(!this.auctionItemList || this.auctionItemList.length < 1){\r\n            this.uiAuctionDetailItem.node.active=false;\r\n        }else{\r\n            this.uiAuctionDetailItem.node.active=true;\r\n        }\r\n        this.auctionList.numItems=this.auctionItemList.length;\r\n    }\r\n\r\n    private ClearList():void\r\n    {\r\n        this.listMain.RemoveAll();\r\n    }\r\n\r\n     /**\r\n     * 拍卖列表渲染\r\n     * @param node\r\n     * @param index \r\n     */\r\n    OnAuctionListRender(node: Node, index: number) {\r\n        let uiAuctionItem=node.getComponent(UIAuctionItem);\r\n        this.listMain.AddItem(node,uiAuctionItem as ListViewItem);\r\n        uiAuctionItem?.SetItemInfo(this.auctionItemList[index],this.uiAuctionDetailItem,index==this.selectedIndex,index,this);\r\n    }    \r\n\r\n    onDestroy(){\r\n        console.log('onDestroy')\r\n        this.listMain.removeListener();\r\n        EventManager.Instance.removeAll(this);\r\n        clearInterval(this.timer);\r\n    }\r\n\r\n}\r\n"]}