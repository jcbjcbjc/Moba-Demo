{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/PowerRanking/UIPowerRanking.ts"],"names":["_decorator","Prefab","Label","UIWindow","proto","EventManager","ListView","UIPowerRankingItem","EventType","CombatPowerRankingManager","List","ccclass","property","NItem","CombatPowerRankingResponse","NUser","FollowResponse","UIPowerRanking","start","console","log","listMain","owner","isAddScene","Instance","addListener","ListView_OnItemSelected","OnItemSelected","CombatPowerRankingRefieshUI","RefieshUI","SendCombatPowerRanking","param","uiPowerRankingItem","ClearList","InitCombatPowerRanking","userList","response","combatPowerRankingResponse","i","users","length","user","push","myPowerRankingLabel","string","myRanking","powerRankingList","numItems","RemoveAll","OnPowerRankingListRender","node","index","getComponent","AddItem","SetItemInfo","onDestroy","removeListener","removeAll"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, Prefab, instantiate, Button, Label } from 'cc';\r\nimport { UIWindow } from '../Common/UIWindow';\r\nimport { User } from '../../Models/User';\r\nimport proto from '../../../Proto/proto.js';\r\nimport { EventManager } from '../Common/Event/EventManager';\r\nimport { ListView } from '../Common/ListView/ListView';\r\nimport { UIPowerRankingItem } from './UIPowerRankingItem';\r\nimport { ListViewItem } from '../Common/ListView/ListViewItem';\r\nimport { EventType } from '../Common/Event/EventType';\r\nimport { TabView } from '../Common/TabView/TabView';\r\nimport { DataManager } from '../../Managers/DataManager';\r\nimport { MessageBox, MessageBoxType } from '../Common/MessageBox';\r\nimport { ItemService } from '../../Services/ItemService';\r\nimport { UserService } from '../../Services/UserService';\r\nimport { CombatPowerRankingManager } from '../../Managers/CombatPowerRankingManager';\r\nimport List from '../Common/ScrollView/List';\r\nconst { ccclass, property } = _decorator;\r\nconst { NItem, CombatPowerRankingResponse, NUser, FollowResponse } = proto;\r\n\r\n@ccclass('UIPowerRanking')\r\nexport class UIPowerRanking extends UIWindow {\r\n\r\n    @property(List) \r\n    private powerRankingList = null as unknown as List;\r\n    @property(Prefab)\r\n    public itemPrefab:Prefab=null as unknown as Prefab;\r\n    @property(ListView)\r\n    public listMain:ListView=null as unknown as ListView;\r\n    @property(Label)\r\n    public myPowerRankingLabel=null as unknown as Label;  //我的排行\r\n\r\n    public selectedIndex:number=0;\r\n    private index:number=0;  //选择索引\r\n\r\n    private uiPowerRankingItem:UIPowerRankingItem=null as unknown as UIPowerRankingItem;\r\n    private userList:Array<NUser> = [];\r\n\r\n    start () {\r\n        console.log('UIPowerRanking start')\r\n        this.listMain.owner=this;\r\n        this.listMain.isAddScene=false;\r\n        EventManager.Instance.addListener(EventType.ListView_OnItemSelected,this.OnItemSelected,this);\r\n        EventManager.Instance.addListener(EventType.CombatPowerRankingRefieshUI,this.RefieshUI,this);\r\n        CombatPowerRankingManager.Instance.SendCombatPowerRanking();\r\n\r\n    }\r\n\r\n    private OnItemSelected(param:any){\r\n        this.uiPowerRankingItem=param[0] as UIPowerRankingItem;\r\n        console.log('OnItemSelected=')\r\n    }\r\n\r\n\r\n    public RefieshUI(){\r\n        this.ClearList();\r\n        this.InitCombatPowerRanking();\r\n    }\r\n\r\n     /**\r\n     * 排行榜初始化\r\n     */\r\n    private async InitCombatPowerRanking(){\r\n        this.userList = [];\r\n        let response = CombatPowerRankingManager.Instance.combatPowerRankingResponse;\r\n        if(response){\r\n            for(let i=0;i<response.users.length;i++){\r\n                let user=response.users[i] as unknown as NUser;\r\n                this.userList.push(user);\r\n            }\r\n            this.myPowerRankingLabel.string=(response.myRanking==-1) ? '你当前未上榜' : '你当前排在'+response.myRanking+'位';\r\n        }\r\n\r\n        this.powerRankingList.numItems=this.userList.length;\r\n    }\r\n\r\n    private ClearList():void{\r\n        this.listMain.RemoveAll();\r\n    }\r\n\r\n     /**\r\n     * 战力排行列表渲染\r\n     * @param node\r\n     * @param index \r\n     */\r\n    OnPowerRankingListRender(node: Node, index: number) {\r\n        let uiPowerRankingItem=node.getComponent(UIPowerRankingItem);\r\n        this.listMain.AddItem(node,uiPowerRankingItem as ListViewItem);\r\n        uiPowerRankingItem?.SetItemInfo(this.userList[index],this);\r\n    }\r\n\r\n    onDestroy(){\r\n        console.log('onDestroy')\r\n        this.listMain.removeListener();\r\n        EventManager.Instance.removeAll(this);\r\n    }\r\n\r\n}\r\n"]}