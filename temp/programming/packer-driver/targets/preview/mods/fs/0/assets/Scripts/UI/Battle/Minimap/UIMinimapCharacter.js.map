{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Battle/Minimap/UIMinimapCharacter.ts"],"names":["_decorator","Component","Sprite","Color","LoadResUtil","DataManager","User","BattleManager","ccclass","property","UIMinimapCharacter","onLoad","avatarBgSprite","node","getComponent","SetItemInfo","character","minimapBoxVo","user","id","Instance","color","fromHEX","teamType2","currentCharacter","avatarImgSprite","spriteFrame","load_local_sprite","characters","cid","Avatar","update","relaX","renderPosition","x","width","relaY","z","height","pivoX","pivoY","setPosition","minimapWidth","minimapHeight","position","setRotationFromEuler","logicRotation","y"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAuBC,MAAAA,M,OAAAA,M;AAAcC,MAAAA,K,OAAAA,K;;AACjDC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,I,iBAAAA,I;;AAEAC,MAAAA,a,iBAAAA,a;;;;;;;OAGH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;;oCAGjBU,kB,WADZF,OAAO,CAAC,oBAAD,C,UAGHC,QAAQ,CAACP,MAAD,C,oCAHb,MACaQ,kBADb,SACwCT,SADxC,CACkD;AAAA;AAAA;;AAAA;;AAAA,kDAKd,IALc;;AAAA,6CAMjB,IANiB;;AAAA,gDAOV,IAPU;AAAA;;AAS9CU,QAAAA,MAAM,GAAI;AACP,eAAKC,cAAL,GAAsB,KAAKC,IAAL,CAAUC,YAAV,CAAuBZ,MAAvB,CAAtB;AACF;AAED;AACJ;AACA;AACA;AACA;;;AACiBa,QAAAA,WAAW,CAACC,SAAD,EAAqBC,YAArB,EAA+C;AAAA;;AAAA;AACnE,YAAA,KAAI,CAACD,SAAL,GAAiBA,SAAjB;AACA,YAAA,KAAI,CAACC,YAAL,GAAoBA,YAApB,CAFmE,CAGnE;;AACA,gBAAGD,SAAS,CAACE,IAAV,CAAeC,EAAf,IAAqB;AAAA;AAAA,8BAAKC,QAAL,CAAcF,IAAd,CAAmBC,EAA3C,EAA8C;AAAG;AAC7C;AACA,cAAA,KAAI,CAACP,cAAL,CAAoBS,KAApB,GAA4B,IAAIlB,KAAJ,GAAYmB,OAAZ,CAAoB,SAApB,CAA5B;AACH,aAHD,MAGM,IAAGN,SAAS,CAACO,SAAV,IAAuB;AAAA;AAAA,gDAAcH,QAAd,CAAuBI,gBAAvB,CAAwCD,SAAlE,EAA4E;AAAG;AACjF;AACA,cAAA,KAAI,CAACX,cAAL,CAAoBS,KAApB,GAA4B,IAAIlB,KAAJ,GAAYmB,OAAZ,CAAoB,SAApB,CAA5B;AACH,aAHK,MAGD;AAAG;AACJ;AACA,cAAA,KAAI,CAACV,cAAL,CAAoBS,KAApB,GAA4B,IAAIlB,KAAJ,GAAYmB,OAAZ,CAAoB,SAApB,CAA5B;AACH,aAbkE,CAcnE;;;AACA,YAAA,KAAI,CAACG,eAAL,CAAqBC,WAArB,SAAyC;AAAA;AAAA,4CAAYC,iBAAZ,CAA8B;AAAA;AAAA,4CAAYP,QAAZ,CAAqBQ,UAArB,CAAgCZ,SAAS,CAACE,IAAV,CAAeF,SAAf,CAAyBa,GAAzD,EAA8DC,MAA9D,GAAqE,cAAnG,CAAzC;AAfmE;AAgBtE,SAlC6C,CAoC9C;;;AACAC,QAAAA,MAAM,GAAE;AACJ,cAAG,KAAKf,SAAL,IAAkB,KAAKC;AAAa;AAAvC,YAAiE;AAC7D;AACA,kBAAIe,KAAK,GAAC,EAAE,KAAKhB,SAAL,CAAeiB,cAAf,CAA8BC,CAA9B,GAAkC,KAAKjB,YAAL,CAAkBiB,CAAtD,IAA2D,KAAKjB,YAAL,CAAkBkB,KAAlB,GAAwB,CAA7F;AACA,kBAAIC,KAAK,GAAC,EAAE,KAAKpB,SAAL,CAAeiB,cAAf,CAA8BI,CAA9B,GAAkC,KAAKpB,YAAL,CAAkBoB,CAAtD,IAA2D,KAAKpB,YAAL,CAAkBqB,MAAlB,GAAyB,CAA9F,CAH6D,CAK7D;;AACA,kBAAIC,KAAK,GAAGP,KAAK,GAAC,KAAKf,YAAL,CAAkBkB,KAApC;AACA,kBAAIK,KAAK,GAAGJ,KAAK,GAAC,KAAKnB,YAAL,CAAkBqB,MAApC;AAEA,mBAAKzB,IAAL,CAAU4B,WAAV,CAAsB,KAAKxB,YAAL,CAAkByB,YAAlB,GAA+BF,KAA/B,GAAuC,KAAKvB,YAAL,CAAkByB,YAAlB,GAA+B,CAA5F,EACI,KAAKzB,YAAL,CAAkB0B,aAAlB,GAAgCJ,KAAhC,GAAwC,KAAKtB,YAAL,CAAkB0B,aAAlB,GAAgC,CAD5E,EAC+E,KAAK9B,IAAL,CAAU+B,QAAV,CAAmBP,CADlG;AAGA,mBAAKxB,IAAL,CAAUgC,oBAAV,CAA+B,CAA/B,EAAkC,CAAlC,EAAqC,KAAK7B,SAAL,CAAe8B,aAAf,CAA6BC,CAA7B,GAA+B,EAApE,EAZ6D,CAc7D;AACA;AACA;AACA;AACA;AACH;AACJ;;AA1D6C,O;;;;;iBAGb,I","sourcesContent":["\r\nimport { _decorator, Component, Node, Rect, Sprite, Vec3, Color } from 'cc';\r\nimport { LoadResUtil } from '../../../Utils/LoadResUtil';\r\nimport { DataManager } from '../../../Managers/DataManager';\r\nimport { User } from '../../../Models/User';\r\nimport { TeamType2 } from '../enums/TeamType2';\r\nimport { BattleManager } from '../Managers/BattleManager';\r\nimport { MinimapBoxVo } from '../../../Vo/MinimapBoxVo';\r\nimport { Creature } from '../Enities/Creature';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('UIMinimapCharacter')\r\nexport class UIMinimapCharacter extends Component {\r\n\r\n    @property(Sprite)\r\n    private avatarImgSprite:Sprite = null;\r\n\r\n    private avatarBgSprite:Sprite = null;\r\n    private character:Creature = null;\r\n    private minimapBoxVo:MinimapBoxVo = null;\r\n\r\n    onLoad () {\r\n       this.avatarBgSprite = this.node.getComponent(Sprite);\r\n    }\r\n\r\n    /**\r\n     * 设置信息\r\n     * @param character \r\n     * @param minimapBoxVo \r\n     */\r\n    public async SetItemInfo(character:Creature, minimapBoxVo:MinimapBoxVo){\r\n        this.character = character;\r\n        this.minimapBoxVo = minimapBoxVo;\r\n        //更换背景颜色\r\n        if(character.user.id == User.Instance.user.id){  //自己\r\n            // this.avatarBgSprite.color.fromHEX('#00FF00');\r\n            this.avatarBgSprite.color = new Color().fromHEX('#00FF00');\r\n        }else if(character.teamType2 == BattleManager.Instance.currentCharacter.teamType2){  //友队\r\n            // this.avatarBgSprite.color.fromHEX('#0085FF');\r\n            this.avatarBgSprite.color = new Color().fromHEX('#0085FF');\r\n        }else{  //敌对\r\n            // this.avatarBgSprite.color.fromHEX('#FF0000');\r\n            this.avatarBgSprite.color = new Color().fromHEX('#FF0000');\r\n        }\r\n        //加载头像\r\n        this.avatarImgSprite.spriteFrame = await LoadResUtil.load_local_sprite(DataManager.Instance.characters[character.user.character.cid].Avatar+'/spriteFrame');\r\n    }\r\n\r\n    // private isPrintResult:boolean=true;\r\n    update(){\r\n        if(this.character && this.minimapBoxVo /*&& this.isPrintResult*/){     \r\n            //获取角色在包围盒的x、y位置\r\n            let relaX=-(this.character.renderPosition.x - this.minimapBoxVo.x) + this.minimapBoxVo.width/2;\r\n            let relaY=-(this.character.renderPosition.z - this.minimapBoxVo.z) + this.minimapBoxVo.height/2;\r\n         \r\n            //获取角色在包围盒的x、y比例\r\n            let pivoX = relaX/this.minimapBoxVo.width;\r\n            let pivoY = relaY/this.minimapBoxVo.height;\r\n\r\n            this.node.setPosition(this.minimapBoxVo.minimapWidth*pivoY - this.minimapBoxVo.minimapWidth/2,\r\n                this.minimapBoxVo.minimapHeight*pivoX - this.minimapBoxVo.minimapHeight/2, this.node.position.z )\r\n\r\n            this.node.setRotationFromEuler(0, 0, this.character.logicRotation.y+90);\r\n\r\n            // console.log('characterId='+this.character.user.id+'，character.renderPosition='+this.character.renderPosition\r\n            // +'，minimapBoxVo='+JSON.stringify(this.minimapBoxVo)+'，pivoX='+pivoX+'，pivoY='+pivoY)\r\n            // console.log('characterId='+this.character.user.id+'==='+(this.minimapBoxVo.minimapWidth*pivoY - this.minimapBoxVo.minimapWidth/2)+'===='+\r\n            //     (this.minimapBoxVo.minimapHeight*pivoX - this.minimapBoxVo.minimapHeight/2))\r\n            // this.isPrintResult=false;\r\n        }\r\n    }\r\n}\r\n"]}