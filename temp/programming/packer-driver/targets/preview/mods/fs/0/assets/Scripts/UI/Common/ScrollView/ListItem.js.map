{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Common/ScrollView/ListItem.ts"],"names":["Node","Component","Enum","Sprite","SpriteFrame","tween","_decorator","EventHandler","Tween","Button","UITransform","Vec3","ccclass","property","disallowMultiple","menu","executionOrder","SelectedType","ListItem","type","tooltip","visible","selectedMode","NONE","SWITCH","selected","val","_selected","selectedFlag","TOGGLE","active","sp","getComponent","spriteFrame","selectedSpriteFrame","_unselectedSpriteFrame","btnCom","_btnCom","node","onLoad","com","onDestroy","off","EventType","SIZE_CHANGED","_onSizeChange","_registerEvent","_eventReg","list","clickEvents","unshift","createEvt","adaptiveSize","on","_onItemAdaptive","component","handlerName","isValid","name","match","pop","replace","evt","target","handler","showAni","aniType","callFunc","del","t","twe","ut","to","scale","by","position","height","width","call","_delSingleItem","n","displayData","length","id","listId","splice","start","onClickThis","selectedId"],"mappings":"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","sourcesContent":["/******************************************\n * @author kL <klk0@qq.com>\n * @date 2019/12/9\n * @doc 列表Item组件.\n * 说明：\n *      1、此组件须配合List组件使用。（配套的配套的..）\n * @end\n ******************************************/\nconst { ccclass, property, disallowMultiple, menu, executionOrder } = _decorator;\nimport { Node, Component, Enum, Sprite, SpriteFrame, tween, _decorator, EventHandler, Tween, Button, UITransform, Vec3 } from 'cc';\nimport List from './List';\n\nenum SelectedType {\n    NONE = 0,\n    TOGGLE = 1,\n    SWITCH = 2,\n}\n\n@ccclass\n@disallowMultiple()\n@menu('List Item')\n@executionOrder(-5001)          //先于List\nexport default class ListItem extends Component {\n    //图标\n    // @property({ type: Sprite, tooltip:  '图标' })\n    // icon: Sprite = null;\n    // //标题\n    // @property({ type: Node, tooltip:  '标题' })\n    // title: Node = null;\n    //选择模式\n    @property({\n        type: Enum(SelectedType),\n        tooltip:  '选择模式'\n    })\n    selectedMode: SelectedType = SelectedType.NONE;\n    //被选标志\n    @property({\n        type: Node, tooltip:  '被选标识',\n        visible() { return this.selectedMode > SelectedType.NONE }\n    })\n    selectedFlag: Node = null;\n    //被选择的SpriteFrame\n    @property({\n        type: SpriteFrame, tooltip:  '被选择的SpriteFrame',\n        visible() { return this.selectedMode == SelectedType.SWITCH }\n    })\n    selectedSpriteFrame: SpriteFrame = null;\n    //未被选择的SpriteFrame\n    _unselectedSpriteFrame: SpriteFrame = null;\n    //自适应尺寸\n    @property({\n        tooltip:  '自适应尺寸（宽或高）',\n    })\n    adaptiveSize: boolean = false;\n    //选择\n    _selected: boolean = false;\n    set selected(val: boolean) {\n        this._selected = val;\n        Tween\n        if (!this.selectedFlag)\n            return;\n        switch (this.selectedMode) {\n            case SelectedType.TOGGLE:\n                this.selectedFlag.active = val;\n                break;\n            case SelectedType.SWITCH:\n                let sp: Sprite = this.selectedFlag.getComponent(Sprite);\n                if (sp) {\n                    sp.spriteFrame = val ? this.selectedSpriteFrame : this._unselectedSpriteFrame;\n                }\n                break;\n        }\n    }\n    get selected() {\n        return this._selected;\n    }\n    //按钮组件\n    private _btnCom: any;\n    get btnCom() {\n        if (!this._btnCom)\n            this._btnCom = this.node.getComponent(Button);\n        return this._btnCom;\n    }\n    //依赖的List组件\n    public list: List;\n    //是否已经注册过事件\n    private _eventReg = false;\n    //序列id\n    public listId: number;\n\n    onLoad() {\n        // //没有按钮组件的话，selectedFlag无效\n        // if (!this.btnCom)\n        //     this.selectedMode == SelectedType.NONE;\n        //有选择模式时，保存相应的东西\n        if (this.selectedMode == SelectedType.SWITCH) {\n            let com: Sprite = this.selectedFlag.getComponent(Sprite);\n            this._unselectedSpriteFrame = com.spriteFrame;\n        }\n    }\n\n    onDestroy() {\n        this.node.off(Node.EventType.SIZE_CHANGED, this._onSizeChange, this);\n    }\n\n    _registerEvent() {\n        if (!this._eventReg) {\n            if (this.btnCom && this.list.selectedMode > 0) {\n                this.btnCom.clickEvents.unshift(this.createEvt(this, 'onClickThis'));\n            }\n            if (this.adaptiveSize) {\n                this.node.on(Node.EventType.SIZE_CHANGED, this._onSizeChange, this);\n            }\n            this._eventReg = true;\n        }\n    }\n\n    _onSizeChange() {\n        this.list._onItemAdaptive(this.node);\n    }\n    /**\n     * 创建事件\n     * @param {cc.Component} component 组件脚本\n     * @param {string} handlerName 触发函数名称\n     * @param {cc.Node} node 组件所在node（不传的情况下取component.node）\n     * @returns cc.Component.EventHandler\n     */\n    createEvt(component: Component, handlerName: string, node: Node = null) {\n        if (!component.isValid)\n            return;//有些异步加载的，节点以及销毁了。\n        component['comName'] = component['comName'] || component.name.match(/\\<(.*?)\\>/g).pop().replace(/\\<|>/g, '');\n        let evt = new EventHandler();\n        evt.target = node || component.node;\n        evt.component = component['comName'];\n        evt.handler = handlerName;\n        return evt;\n    }\n\n    showAni(aniType: number, callFunc: Function, del: boolean) {\n        let t: any = this;\n        let twe: Tween<Node>;\n        let ut: UITransform = t.node.getComponent(UITransform);\n        switch (aniType) {\n            case 0: //向上消失\n                twe = tween(t.node)\n                    .to(.2, { scale: new Vec3(.7, .7) })\n                    .by(.3, { position: new Vec3(0, ut.height * 2) });\n                break;\n            case 1: //向右消失\n                twe = tween(t.node)\n                    .to(.2, { scale: new Vec3(.7, .7) })\n                    .by(.3, { position: new Vec3(ut.width * 2, 0) });\n                break;\n            case 2: //向下消失\n                twe = tween(t.node)\n                    .to(.2, { scale: new Vec3(.7, .7) })\n                    .by(.3, { position: new Vec3(0, ut.height * -2) });\n                break;\n            case 3: //向左消失\n                twe = tween(t.node)\n                    .to(.2, { scale: new Vec3(.7, .7) })\n                    .by(.3, { position: new Vec3(ut.width * -2, 0) });\n                break;\n            default: //默认：缩小消失\n                twe = tween(t.node)\n                    .to(.3, { scale: new Vec3(.1, .1) });\n                break;\n        }\n\n        if (callFunc || del) {\n            twe.call(() => {\n                if (del) {\n                    t.list._delSingleItem(t.node);\n                    for (let n: number = t.list.displayData.length - 1; n >= 0; n--) {\n                        if (t.list.displayData[n].id == t.listId) {\n                            t.list.displayData.splice(n, 1);\n                            break;\n                        }\n                    }\n                }\n                callFunc();\n            });\n        }\n        twe.start();\n    }\n\n    onClickThis() {\n        this.list.selectedId = this.listId;\n    }\n\n}\n"]}