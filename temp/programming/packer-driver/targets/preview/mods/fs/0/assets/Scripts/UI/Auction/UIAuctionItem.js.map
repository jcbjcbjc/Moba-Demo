{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Auction/UIAuctionItem.ts"],"names":["_decorator","Label","Sprite","SystemEventType","SpriteFrame","ListViewItem","proto","EventManager","DataManager","LoadResUtil","ccclass","property","NItem","Result","NAuctionItem","UIAuctionItem","onLoad","index","console","log","node","on","TOUCH_END","OnPointerClick","nodeBgSprite","getComponent","normalBgSpriteFrame","spriteFrame","onSelected","selected","selectBgSpriteFrame","uiAuctionDetailItem","SetItemInfo","item","itemDefine","uiAuction","selectedIndex","Instance","items","itemId","nameLabel","string","Name","count","priceLabel","bidderUserId","currentPrice","biddingPrice","imgSprite","load_local_sprite","Icon","update","dt","time","remainingTime","color","a","onDestroy","removeAll"],"mappings":"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","sourcesContent":["import { ListViewItem } from \"../Common/ListView/ListViewItem\";\r\n\r\nimport { _decorator, Component, Node, Prefab, Label, Sprite, SystemEventType, SpriteFrame, tween, v3, Vec3 } from 'cc';\r\nimport { UIWindow } from '../Common/UIWindow';\r\nimport { User } from '../../Models/User';\r\nimport proto from '../../../Proto/proto.js';\r\nimport { EventManager } from \"../Common/Event/EventManager\";\r\nimport { ListView } from \"../Common/ListView/ListView\";\r\nimport { DataManager } from \"../../Managers/DataManager\";\r\nimport { LoadResUtil } from \"../../Utils/LoadResUtil\";\r\nimport { UIAuctionDetailItem } from \"./UIAuctionDetailItem\";\r\nimport { UIAuction } from \"./UIAuction\";\r\nimport { ShopItemDefine } from \"../../Data/ShopItemDefine\";\r\nimport { ItemDefine } from \"../../Data/ItemDefine\";\r\nconst { ccclass, property } = _decorator;\r\nconst { NItem, Result,NAuctionItem } = proto;\r\n\r\n@ccclass('UIAuctionItem')\r\nexport class UIAuctionItem extends ListViewItem {\r\n\r\n    @property(Label)\r\n    public nameLabel=null as unknown as Label;\r\n    @property(Sprite)\r\n    public imgSprite=null as unknown as Sprite;\r\n    @property(Label)\r\n    public priceLabel=null as unknown as Label;\r\n    @property(SpriteFrame)\r\n    public selectBgSpriteFrame=null as unknown as SpriteFrame;\r\n\r\n    public normalBgSpriteFrame=null as unknown as SpriteFrame;\r\n    private nodeBgSprite:Sprite=null as unknown as Sprite;\r\n    public item=null as unknown as NAuctionItem;\r\n    public uiAuctionDetailItem=null as unknown as UIAuctionDetailItem;\r\n    private index:number=0;\r\n    private uiAuction=null as unknown as UIAuction; \r\n    public itemDefine=null as unknown as ItemDefine;\r\n\r\n    onLoad () {\r\n      if(this.index==0){\r\n        console.log('onLoad index='+this.index) \r\n      }\r\n      this.node.on(SystemEventType.TOUCH_END,this.OnPointerClick,this);\r\n      this.nodeBgSprite=this.node.getComponent(Sprite) as Sprite;\r\n      this.normalBgSpriteFrame = this.nodeBgSprite.spriteFrame as SpriteFrame;\r\n    }\r\n\r\n    public onSelected(selected:boolean):void{\r\n      if(this.index==0){\r\n        console.log('onSelected index='+this.index)\r\n      }\r\n        // console.log('selected='+selected)\r\n        if(this.nodeBgSprite){\r\n           this.nodeBgSprite.spriteFrame = selected ? this.selectBgSpriteFrame : this.normalBgSpriteFrame;\r\n        }\r\n        if(selected){  //选中，更新右边详细\r\n           this.uiAuctionDetailItem.SetItemInfo(this.item,this.itemDefine,this.index, this.uiAuction);\r\n           this.uiAuction.selectedIndex=this.index;\r\n        }\r\n    }\r\n\r\n    public async SetItemInfo(item:NAuctionItem,uiAuctionDetailItem:UIAuctionDetailItem,selected:boolean=false,index:number=-1,uiAuction:UIAuction){\r\n      this.item=item;\r\n      if(index != -1){\r\n        this.index=index;\r\n      }\r\n      this.uiAuction=uiAuction;\r\n      this.uiAuctionDetailItem=uiAuctionDetailItem;\r\n      this.itemDefine= DataManager.Instance.items[item.itemId];\r\n       this.nameLabel.string=this.itemDefine.Name+'x'+item.count;\r\n       this.priceLabel.string=item.bidderUserId ? item.currentPrice : item.biddingPrice;\r\n       this.imgSprite.spriteFrame=await LoadResUtil.load_local_sprite(this.itemDefine.Icon+'/spriteFrame');\r\n       if(selected){\r\n        this.OnPointerClick();\r\n       }\r\n       \r\n    }  \r\n\r\n    private time=0;\r\n    public update(dt:number){\r\n      this.time += dt;\r\n      if(this.item.remainingTime <= 60000){  //闪烁\r\n        if(this.time > 0.5){ \r\n          this.time=0;\r\n          this.nodeBgSprite.color.a = (this.nodeBgSprite.color.a==1) ? 255 : 1;\r\n        }\r\n      }else{\r\n        this.nodeBgSprite.color.a = 255;\r\n      }\r\n    }\r\n\r\n\r\n    onDestroy(){\r\n        console.log('onDestroy')\r\n        EventManager.Instance.removeAll(this);\r\n    }\r\n}"]}