{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Battle/UIBattleChat.ts"],"names":["_decorator","Component","EditBox","proto","TabView","EventManager","EventType","ChatManager","UIBattleChatItem","List","TipsManager","ChatService","ccclass","property","NItem","ChatMessage","ChatChannel","ChatRoomType","UIBattleChat","Array","start","tab","owner","OnChangeChannel","Instance","addListener","TabView_OnTabSelect","OnChat_UI","param","channel","RoomChat","InitChat","index","console","log","messageList","gameMessages","liveMessages","chatList","numItems","length","scrollTo","OnChatListRender","item","uiBattleChatItem","getComponent","SetItemInfo","OnClickSend","contentEditBox","string","showTips","SendChat","Game_","Live_"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, Label, Sprite, SystemEventType, SpriteFrame, EditBox } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\nimport proto from '../../../Proto/proto.js';\r\nimport { BattleGlobal } from './Utils/BattleGlobal';\r\nimport { BattleMode } from './enums/BattleMode';\r\nimport { TabView } from '../Common/TabView/TabView';\r\nimport { EventManager } from '../Common/Event/EventManager';\r\nimport { EventType } from '../Common/Event/EventType';\r\nimport { ChatManager } from '../../Managers/ChatManager';\r\nimport { UIBattleChatItem } from './UIBattleChatItem';\r\nimport List from '../Common/ScrollView/List';\r\nimport { TipsManager } from '../TipsManager';\r\nimport { ChatService } from '../../Services/ChatService';\r\nconst { NItem, ChatMessage, ChatChannel,ChatRoomType } = proto;\r\n\r\n@ccclass('UIBattleChat')\r\nexport class UIBattleChat extends Component{\r\n\r\n    @property(TabView)\r\n    public tab:TabView=null as unknown as TabView; \r\n    @property(List) \r\n    private chatList = null as unknown as List;\r\n    @property(EditBox)\r\n    public contentEditBox=null as unknown as EditBox;\r\n\r\n    private index:number=-1;  //选择索引 0、我方  1、观看直播粉丝\r\n    private messageList=new Array<ChatMessage>();  //消息集合\r\n\r\n    start () {\r\n        if(this.tab){ //对战玩家\r\n          this.tab.owner=this;\r\n        }else{   //观看直播用户\r\n          this.OnChangeChannel([1]);\r\n        }\r\n        EventManager.Instance.addListener(EventType.TabView_OnTabSelect,this.OnChangeChannel,this);\r\n        EventManager.Instance.addListener(EventType.OnChat_UI, this.OnChat_UI, this);\r\n    }\r\n\r\n    /**\r\n     * 收到消息更新\r\n     * @param param \r\n     */\r\n    private OnChat_UI(param:any){\r\n        let channel = param[0] as ChatChannel;\r\n        if(channel==ChatChannel.RoomChat){  //房间\r\n            this.InitChat();\r\n        } \r\n    }\r\n\r\n    /**\r\n     * 切换选择频道\r\n     * @param param 索引\r\n     */\r\n    private OnChangeChannel(param:any){\r\n        let index=param[0];\r\n        if(this.index==index){\r\n            return;\r\n        }\r\n        this.index=index;\r\n        console.log('OnChangeChannel index='+this.index) \r\n        this.InitChat();\r\n    }\r\n\r\n    /**\r\n     * 初始化聊天\r\n     */\r\n    public InitChat(){\r\n        this.messageList = this.index==0 ? ChatManager.Instance.gameMessages : ChatManager.Instance.liveMessages;\r\n        this.chatList.numItems=this.messageList.length;\r\n        this.chatList.scrollTo(this.messageList.length);\r\n    }\r\n\r\n    /**\r\n     * 聊天列表渲染\r\n     * @param item \r\n     * @param index \r\n     */\r\n    OnChatListRender(item: Node, index: number) {\r\n        let uiBattleChatItem=item.getComponent(UIBattleChatItem);\r\n        uiBattleChatItem?.SetItemInfo(this.messageList[index],  this.index);\r\n    }\r\n\r\n    /**\r\n     * 点击发送\r\n     */\r\n    public async OnClickSend(){\r\n        if(!this.contentEditBox.string){\r\n            TipsManager.Instance.showTips('请输入发送的内容');\r\n            return;\r\n        }\r\n        \r\n        ChatService.Instance.SendChat(ChatChannel.RoomChat, this.contentEditBox.string, this.index==0 ? ChatRoomType.Game_ : ChatRoomType.Live_);                 \r\n        this.contentEditBox.string='';\r\n    }\r\n\r\n}"]}