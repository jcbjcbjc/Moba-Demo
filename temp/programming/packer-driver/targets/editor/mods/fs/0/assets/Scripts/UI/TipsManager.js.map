{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/TipsManager.ts"],"names":["_decorator","Component","game","Prefab","instantiate","director","view","UITips","ccclass","property","TipsManager","start","addPersistRootNode","node","Instance","windowSize","getCanvasSize","console","log","createShowNode","content","labelNode","tipsList","length","shift","labelPfb","uiTips","getComponent","LabelText","setPosition","width","height","newNode","getScene","getChildByUuid","uuid","addChild","err","update","moveTipsList","i","pos","position","y","x","z","removeChild","push","splice","showTips","str"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, game, Prefab, instantiate, director, v2, Label, view, math, tween, Vec3 } from 'cc';\r\nimport { UITips } from './Common/UITips';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('TipsManager')\r\nexport class TipsManager extends Component {\r\n\r\n  @property(Prefab)\r\n  public labelPfb: Prefab = null as unknown as Prefab;\r\n  public static Instance: TipsManager = null as unknown as TipsManager;\r\n  private tipsList: Array<Node> = []; //提示节点集合\r\n  private windowSize: math.Size = null as unknown as math.Size;\r\n\r\n  private moveTipsList: Array<Node> = [];\r\n\r\n  start() {\r\n    game.addPersistRootNode(this.node);\r\n    if (!TipsManager.Instance) {\r\n      TipsManager.Instance = this;\r\n    }\r\n    this.windowSize = view.getCanvasSize();\r\n    console.log('windowSize=' + this.windowSize)\r\n  }\r\n\r\n  /**\r\n   * 创建显示节点\r\n   * @param content \r\n   */\r\n  private createShowNode(content: string): Node {\r\n    try {\r\n      let labelNode = null as unknown as Node;\r\n      if (this.tipsList.length > 3) {\r\n        labelNode = this.tipsList.shift() as Node;\r\n        console.log('缓存取节点 size=' + this.tipsList.length)\r\n      } else {\r\n        labelNode = instantiate(this.labelPfb)\r\n        // this.tipsList.push(labelNode)\r\n      }\r\n      //设置内容\r\n      let uiTips = (labelNode.getComponent(UITips) as UITips);\r\n      uiTips.LabelText = content;\r\n      //设置位置\r\n      uiTips.labelNode.setPosition(0, 0, 0);\r\n      labelNode.setPosition(this.windowSize.width / 2, this.windowSize.height / 2, 0);\r\n      let newNode = director.getScene()?.getChildByUuid(labelNode.uuid);\r\n      if (!newNode) {  //未找到\r\n        console.log('添加到场景' + labelNode.uuid)\r\n        director.getScene()?.addChild(labelNode);\r\n      }\r\n      return labelNode;\r\n    } catch (err) {\r\n      console.log(err)\r\n    }\r\n    return null as unknown as Node;\r\n  }\r\n\r\n  update() {\r\n    if (this.moveTipsList.length > 0) {\r\n      try {\r\n        for (let i = 0; i < this.moveTipsList.length; i++) {\r\n          let labelNode = this.moveTipsList[i];\r\n          let uiTips = (labelNode.getComponent(UITips) as UITips);\r\n          let pos = uiTips.labelNode.position;\r\n\r\n          // console.log('pos='+pos)\r\n          let y = pos.y + 0.8;\r\n          uiTips.labelNode.setPosition(pos.x, y, pos.z);\r\n          if (y > 25) {  //移除\r\n            console.log('移除id=' + labelNode.uuid)\r\n            director.getScene()?.removeChild(labelNode);\r\n            this.tipsList.push(labelNode);\r\n            this.moveTipsList.splice(i, 1);\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.log(err)\r\n        this.moveTipsList = [];\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 显示提示\r\n   * @param str \r\n   */\r\n  public showTips(str: string) {\r\n    let labelNode = this.createShowNode(str)\r\n    if (labelNode) {\r\n      this.moveTipsList.push(labelNode);\r\n    }\r\n  }\r\n\r\n\r\n}\r\n"]}