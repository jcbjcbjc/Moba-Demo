{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/Managers/CombatPowerRankingManager.ts"],"names":["CombatPowerRankingManager","UserService","EventManager","EventType","FollowManager","Init","Instance","addListener","OnCombatPowerRanking","OnFollowRes_UI","OnUserStatusChange_UI","SendCombatPowerRanking","param","response","combatPowerRankingResponse","dispatch","CombatPowerRankingRefieshUI","users","i","length","user","id","followUserId","isFollow","j","userStatusChanges","userStatusChange","userId","status"],"mappings":"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","sourcesContent":["import { UserService } from \"../Services/UserService\";\r\nimport { EventManager } from \"../UI/Common/Event/EventManager\";\r\nimport { EventType } from \"../UI/Common/Event/EventType\";\r\nimport { CombatPowerRankingResponse, FollowResponse, NUser, UserStatusChangeResponse } from \"../../Proto/proto\";\r\nimport { FollowManager } from \"./FollowManager\";\r\n\r\nexport class CombatPowerRankingManager{\r\n    public static Instance:CombatPowerRankingManager=new CombatPowerRankingManager();\r\n    public combatPowerRankingResponse=null as unknown as CombatPowerRankingResponse;\r\n\r\n    public Init(){\r\n        EventManager.Instance.addListener(EventType.OnCombatPowerRanking,this.OnCombatPowerRanking,this);\r\n        EventManager.Instance.addListener(EventType.OnFollowRes_UI,this.OnFollowRes_UI,this);\r\n        EventManager.Instance.addListener(EventType.OnUserStatusChange_UI,this.OnUserStatusChange_UI,this);\r\n    }\r\n\r\n     /**\r\n     * 请求战力排行\r\n     */\r\n    public SendCombatPowerRanking(){\r\n        UserService.Instance.SendCombatPowerRanking();\r\n    }\r\n\r\n    /**\r\n     * 排行榜响应\r\n     */\r\n    private OnCombatPowerRanking(param:any){\r\n        let response = param[0] as CombatPowerRankingResponse;\r\n        this.combatPowerRankingResponse=response;\r\n        EventManager.Instance.dispatch(EventType.CombatPowerRankingRefieshUI);\r\n    }\r\n\r\n    /**\r\n     * 关注/取消关注响应\r\n     */\r\n    private OnFollowRes_UI(param: any){\r\n        let response = param[0] as FollowResponse;\r\n        //关注/取消关注成功更新数据\r\n        if(!this.combatPowerRankingResponse){\r\n            return;\r\n        }\r\n        let users=this.combatPowerRankingResponse.users;\r\n        for(let i=0;i<users.length;i++){\r\n            let user=users[i] as NUser;\r\n            if(user.id==FollowManager.Instance.followUserId){ \r\n                user.isFollow=FollowManager.Instance.isFollow;\r\n               break;\r\n            }\r\n        }\r\n        EventManager.Instance.dispatch(EventType.CombatPowerRankingRefieshUI);\r\n    }\r\n\r\n    /**\r\n     * 用户状态变更响应\r\n     */\r\n    private OnUserStatusChange_UI(param: any){\r\n        let response = param[0] as UserStatusChangeResponse;\r\n        //更新数据\r\n        if(!this.combatPowerRankingResponse){\r\n            return;\r\n        }\r\n        let users=this.combatPowerRankingResponse.users;\r\n        for(let i=0;i<users.length;i++){\r\n            let user=users[i] as NUser;\r\n            for(let j=0; j < response.userStatusChanges.length; j++){\r\n               let userStatusChange= response.userStatusChanges[j];\r\n               if(user.id==userStatusChange.userId){\r\n                   user.status=userStatusChange.status;\r\n               }\r\n            }\r\n        }\r\n        EventManager.Instance.dispatch(EventType.CombatPowerRankingRefieshUI);\r\n    }\r\n\r\n    \r\n}"]}