{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Battle/Effects/FXManager.ts"],"names":["_decorator","Component","Prefab","HashMap","EffectController","BattleManager","GlobalPool","BattleGlobal","ccclass","property","FXManager","onLoad","Instance","start","Effects","clear","i","prefabs","length","rootNode","data","active","put","name","createPool","CreateEffect","pos","prefab","get","console","log","go","AllBattleEffectsNode","addChild","worldPosition","getComponent","PlayEffect","type","target","duration","effect","Init","node","playParticleEffect","Array"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAA+BC,MAAAA,S,OAAAA,S;AAAqCC,MAAAA,M,OAAAA,M;;AACpEC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,gB,iBAAAA,gB;;AAEAC,MAAAA,a,iBAAAA,a;;AACFC,MAAAA,U;;AACEC,MAAAA,Y,iBAAAA,Y;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBT,U;;2BAGjBU,S,WADZF,OAAO,CAAC,WAAD,C,UAGHC,QAAQ,CAAC,CAACP,MAAD,CAAD,C,8CAHb,MACaQ,SADb,SAC+BT,SAD/B,CACwC;AAAA;AAAA;;AAAA;;AAAA,2CAKlB;AAAA;AAAA,mCALkB;AAAA;;AASpCU,QAAAA,MAAM,GAAI;AACND,UAAAA,SAAS,CAACE,QAAV,GAAmB,IAAnB;AACH;;AAEMC,QAAAA,KAAK,GACZ;AACI,eAAKC,OAAL,CAAaC,KAAb;;AACA,eAAI,IAAIC,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAKC,OAAL,CAAaC,MAAhC,EAAwCF,CAAC,EAAzC,EACA;AACI,gBAAIG,QAAQ,GAAG,KAAKF,OAAL,CAAaD,CAAb,EAAgBI,IAA/B;AACAD,YAAAA,QAAQ,CAACE,MAAT,GAAgB,KAAhB;AACA,iBAAKP,OAAL,CAAaQ,GAAb,CAAiBH,QAAQ,CAACI,IAA1B,EAAgCJ,QAAhC,EAHJ,CAKI;;AACA;AAAA;AAAA,0CAAWK,UAAX,CAAsBL,QAAQ,CAACI,IAA/B,EAAqCJ,QAArC;AACH;AAEJ;;AAEMM,QAAAA,YAAY,CAACF,IAAD,EAAcG,GAAd,EACnB;AACI;AACA,cAAIC,MAAM,GAAG,KAAKb,OAAL,CAAac,GAAb,CAAiBL,IAAjB,CAAb;;AACA,cAAGI,MAAH,EACA;AACIE,YAAAA,OAAO,CAACC,GAAR,CAAY,4BAA0BP,IAAtC,EADJ,CAEI;;AACA,gBAAIQ,EAAE,GAAG;AAAA;AAAA,0CAAWH,GAAX,CAAeL,IAAf,CAAT,CAHJ,CAII;;AACA;AAAA;AAAA,gDAAcX,QAAd,CAAuBoB,oBAAvB,CAA4CC,QAA5C,CAAqDF,EAArD;AACAA,YAAAA,EAAE,CAACG,aAAH,GAAmBR,GAAnB;AACA,mBAAOK,EAAE,CAACI,YAAH;AAAA;AAAA,qDAAP;AACH;;AACD,iBAAO,IAAP;AACH;;AAEMC,QAAAA,UAAU,CAACC,IAAD,EAAmBd,IAAnB,EAAgCe,MAAhC,EAA6CZ,GAA7C,EAAuDa,QAAvD,EACjB;AACI,cAAIC,MAAM,GAAG,KAAKf,YAAL,CAAkBF,IAAlB,EAAwBG,GAAxB,CAAb;;AACA,cAAI,CAACc,MAAL,EACA;AACIX,YAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAAqCP,IAArC;AACA;AACH;;AACDiB,UAAAA,MAAM,CAACC,IAAP,CAAYJ,IAAZ,EAAkB,KAAKK,IAAvB,EAA6BJ,MAA7B,EAAqCZ,GAArC,EAA0Ca,QAA1C,EAPJ,CAQI;;AACA;AAAA;AAAA,4CAAaI,kBAAb,CAAgCH,MAAM,CAACE,IAAvC;AACH;;AAxDmC,O,uCAOH,I;;;;;iBAJlB,IAAIE,KAAJ,E","sourcesContent":["import { _decorator, instantiate, Node, Component, Vec3, AnimationComponent, Prefab, UITransform, Vec2 } from 'cc';\r\nimport { HashMap } from '../../../Utils/HashMap';\r\nimport { EffectController } from './EffectController';\r\nimport { EffectType } from './EffectType';\r\nimport { BattleManager } from '../Managers/BattleManager';\r\nimport GlobalPool from '../../../Utils/GlobalPool';\r\nimport { BattleGlobal } from '../Utils/BattleGlobal';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('FXManager')\r\nexport class FXManager extends Component{\r\n\r\n    @property([Prefab])\r\n    public prefabs=new Array<Prefab>();\r\n    //key=>name  value=>node\r\n    private Effects = new HashMap();\r\n\r\n    public static Instance:FXManager=null;\r\n\r\n    onLoad () {\r\n        FXManager.Instance=this;\r\n    }\r\n\r\n    public start()\r\n    {\r\n        this.Effects.clear();\r\n        for(let i = 0; i < this.prefabs.length; i++)\r\n        {\r\n            let rootNode = this.prefabs[i].data;\r\n            rootNode.active=false;\r\n            this.Effects.put(rootNode.name, rootNode);\r\n\r\n            //创建对象池\r\n            GlobalPool.createPool(rootNode.name, rootNode);\r\n        }\r\n\r\n    }\r\n\r\n    public CreateEffect(name:string, pos:Vec3):EffectController\r\n    {\r\n        // console.log('CreateEffect Effects='+this.Effects.keys().join('，'))\r\n        let prefab = this.Effects.get(name);\r\n        if(prefab)\r\n        {\r\n            console.log('FXManager CreateEffect：'+name)\r\n            //获取对象实例\r\n            let go = GlobalPool.get(name);\r\n            // let go = instantiate(prefab) as Node;\r\n            BattleManager.Instance.AllBattleEffectsNode.addChild(go);\r\n            go.worldPosition = pos;\r\n            return go.getComponent(EffectController);\r\n        }\r\n        return null;\r\n    }\r\n \r\n    public PlayEffect(type:EffectType,  name:string, target:Node, pos:Vec3, duration:number)\r\n    {\r\n        let effect = this.CreateEffect(name, pos);\r\n        if (!effect)\r\n        {\r\n            console.log(\"Effect:{0} not found.\", name);\r\n            return;\r\n        }\r\n        effect.Init(type, this.node, target, pos, duration);\r\n        // effect.node.active=true;\r\n        BattleGlobal.playParticleEffect(effect.node);\r\n    }\r\n\r\n\t\r\n}"]}