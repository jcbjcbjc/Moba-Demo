{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Battle/UIWorldElementManager.ts"],"names":["_decorator","Component","Node","instantiate","UIWorldElement","UIHpBar","proto","DataManager","UIPopupText","EventManager","EventType","ccclass","property","NUser","UIWorldElementManager","onLoad","Instance","AddCharacterHpBar","owner","creature","hpBarNode2","hpBarNode","node","addChild","uiWorldElement","getComponent","uiHpBar","height","characters","characterDefine","ID","Height","RemoveCharacterHpBar","destroy","ShowPopupText","type","damage","isCrit","isBuff","goPopup","popupTextNode","setPosition","GetPopupOffset","add","renderPosition","isExecuteOnce","name","active","addListener","OnWorldElementExecuteOnceSuccess","InitPopup"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, instantiate, Vec3 } from 'cc';\r\nimport { HashMap } from '../../Utils/HashMap';\r\nimport { UIWorldElement } from './UIWorldElement';\r\nimport { UIHpBar } from './UIHpBar';\r\nimport proto from '../../../Proto/proto.js';\r\nimport { Creature } from './Enities/Creature';\r\nimport { DataManager } from '../../Managers/DataManager';\r\nimport { PopupType } from './enums/PopupType';\r\nimport { UIPopupText } from './UIPopupText';\r\nimport { EventManager } from '../Common/Event/EventManager';\r\nimport { EventType } from '../Common/Event/EventType';\r\nconst { ccclass, property } = _decorator;\r\nconst { NUser }  = proto;\r\n\r\n/**\r\n * 世界元素管理器\r\n */\r\n@ccclass('UIWorldElementManager')\r\nexport class UIWorldElementManager extends Component {\r\n    \r\n    public static Instance:UIWorldElementManager=null;\r\n\r\n    @property(Node)\r\n    public hpBarNode:Node;\r\n    @property(Node)\r\n    public popupTextNode:Node;\r\n\r\n    onLoad () {\r\n          UIWorldElementManager.Instance=this;\r\n\r\n    }\r\n\r\n    /**\r\n     * 添加生物血条\r\n     * @param owner 生物节点\r\n     * @param creature  生物对象\r\n     */\r\n    public AddCharacterHpBar(owner:Node, creature:Creature){\r\n        // console.log('AddCharacterHpBar hpBarNode='+this.hpBarNode);\r\n        //创建血条节点\r\n        let hpBarNode2=instantiate(this.hpBarNode);\r\n        this.node.addChild(hpBarNode2);\r\n        creature.hpBarNode=hpBarNode2;\r\n        //获取血条节点 UIWorldElement、UIHpBar组件\r\n        // hpBarNode2.active=true;\r\n        let uiWorldElement=hpBarNode2.getComponent(UIWorldElement);\r\n        let uiHpBar=hpBarNode2.getComponent(UIHpBar);\r\n        uiWorldElement.owner=owner;\r\n        uiWorldElement.height=DataManager.Instance.characters[creature.characterDefine.ID].Height; \r\n        uiHpBar.owner=creature;\r\n    }\r\n\r\n    /**\r\n     * 移除生物血条\r\n     * @param creature  生物对象\r\n     */\r\n    public RemoveCharacterHpBar(creature:Creature){\r\n        if(creature.hpBarNode){\r\n            // let uiWorldElement=creature.hpBarNode.getComponent(UIWorldElement);\r\n            // let uiHpBar=creature.hpBarNode.getComponent(UIHpBar);\r\n            // uiWorldElement.owner=null;\r\n            // uiHpBar.owner=null;\r\n            creature.hpBarNode.destroy();\r\n            creature.hpBarNode=null;\r\n        }\r\n    }\r\n\r\n\r\n    public ShowPopupText(type:PopupType, creature:Creature, damage:number, isCrit:boolean, isBuff:boolean)\r\n    {\r\n        let goPopup = instantiate(this.popupTextNode);\r\n        goPopup.setPosition(creature.GetPopupOffset().add(creature.renderPosition));\r\n\r\n        let uiWorldElement=goPopup.getComponent(UIWorldElement);\r\n        uiWorldElement.owner = creature.node;\r\n        uiWorldElement.height = creature.characterDefine.Height; \r\n        uiWorldElement.isExecuteOnce=true;\r\n\r\n        goPopup.name = \"Popup\"; \r\n        goPopup.active = true;\r\n        this.node.addChild(goPopup);\r\n        // isCrit=true;\r\n        EventManager.Instance.addListener(EventType.OnWorldElementExecuteOnceSuccess,function(){\r\n          goPopup.getComponent(UIPopupText).InitPopup(type, damage, isCrit, isBuff);\r\n        }, uiWorldElement);\r\n        \r\n    }\r\n}\r\n\r\n"]}