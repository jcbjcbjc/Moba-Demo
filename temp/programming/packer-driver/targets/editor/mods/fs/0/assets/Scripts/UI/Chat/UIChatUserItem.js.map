{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/Chat/UIChatUserItem.ts"],"names":["_decorator","Node","Label","Sprite","SpriteFrame","SystemEventType","ListViewItem","LoadResUtil","DataManager","EventManager","EventType","ChatManager","UIManager","ccclass","property","UIChatUserItem","onLoad","node","on","TOUCH_END","OnPointerClick","avatarSprite","avatarClick","start","nodeBgSprite","getComponent","normalBgSpriteFrame","spriteFrame","chatRedSprite","active","Instance","addListener","OnChangeRedNum","onSelected","selected","selectBgSpriteFrame","SetItemInfo","chatUserVo","index","load_local_sprite","characters","cCharacterId","Avatar","levelLabel","string","level","nickNameLabel","nickName","onLineLabel","status","offLineLabel","userMsgNum","privateUserNum","get","userId","console","log","uiCharacterDetail","show","SendCharacterDetail","onDestroy","removeAll"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, Label, Sprite, SpriteFrame, SystemEventType } from 'cc';\r\nimport { ChatUserVo } from '../../Vo/ChatUserVo';\r\nimport { ListViewItem } from '../Common/ListView/ListViewItem';\r\nimport { LoadResUtil } from '../../Utils/LoadResUtil';\r\nimport { DataManager } from '../../Managers/DataManager';\r\nimport { EventManager } from '../Common/Event/EventManager';\r\nimport { EventType } from '../Common/Event/EventType';\r\nimport { ChatManager } from '../../Managers/ChatManager';\r\nimport { UIManager } from '../Common/UIManager';\r\nimport { UICharacterDetail } from '../UICharacterDetail/UICharacterDetail';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('UIChatUserItem')\r\nexport class UIChatUserItem extends ListViewItem {\r\n    @property(Sprite)\r\n    public avatarSprite=null as unknown as Sprite;\r\n    @property(Label)\r\n    public levelLabel=null as unknown as Label;\r\n    @property(Label)\r\n    public nickNameLabel=null as unknown as Label;\r\n    @property(Node)\r\n    public onLineLabel=null as unknown as Node;\r\n    @property(Node)\r\n    public offLineLabel=null as unknown as Node;\r\n    public chatUserVo =null as unknown as ChatUserVo;\r\n    // @property(Label)\r\n    // private userMsgNumLabel=null as unknown as Label;\r\n    @property(Sprite)\r\n    public chatRedSprite: Sprite = null as unknown as Sprite;\r\n\r\n    @property(SpriteFrame)\r\n    public selectBgSpriteFrame=null as unknown as SpriteFrame;\r\n    public normalBgSpriteFrame=null as unknown as SpriteFrame;\r\n    private nodeBgSprite:Sprite=null as unknown as Sprite;\r\n    public index:number=0;\r\n    \r\n    onLoad () {\r\n        this.node.on(SystemEventType.TOUCH_END,this.OnPointerClick,this); \r\n        this.avatarSprite.node.on(SystemEventType.TOUCH_END, this.avatarClick,this);\r\n    }\r\n\r\n    start () {\r\n      this.nodeBgSprite=this.node.getComponent(Sprite) as Sprite;\r\n      this.normalBgSpriteFrame = this.nodeBgSprite.spriteFrame as SpriteFrame;\r\n      this.chatRedSprite.node.active = false;\r\n      EventManager.Instance.addListener(EventType.OnChangeRedNum,this.OnChangeRedNum,this);\r\n      this.OnChangeRedNum();\r\n    }\r\n\r\n    public onSelected(selected:boolean):void{\r\n          // console.log('selected='+selected)\r\n          if(this.nodeBgSprite){\r\n             this.nodeBgSprite.spriteFrame = selected ? this.selectBgSpriteFrame : this.normalBgSpriteFrame;\r\n          }\r\n      }\r\n\r\n    public async SetItemInfo(chatUserVo : ChatUserVo,selected:boolean=false, index:number){\r\n        this.index=index;\r\n        if(!chatUserVo){\r\n          return;\r\n        }\r\n        this.chatUserVo=chatUserVo;\r\n        this.avatarSprite.spriteFrame=await LoadResUtil.load_local_sprite(DataManager.Instance.characters[chatUserVo.cCharacterId].Avatar+'/spriteFrame');\r\n        this.levelLabel.string='lv'+chatUserVo.level;\r\n        this.nickNameLabel.string=chatUserVo.nickName;\r\n        this.onLineLabel.active=chatUserVo.status;\r\n        this.offLineLabel.active=!chatUserVo.status;\r\n\r\n        if(selected){\r\n          this.OnPointerClick();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 消息数量改变\r\n     */\r\n    private OnChangeRedNum(){\r\n      let userMsgNum=ChatManager.Instance.privateUserNum.get(this.chatUserVo.userId) || 0;\r\n      // this.userMsgNumLabel.string=(userMsgNum > 99 ? '99+' : userMsgNum+'');\r\n      if (userMsgNum > 0) {\r\n        this.chatRedSprite.node.active = true;\r\n      } else {\r\n        this.chatRedSprite.node.active = false;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * 头像点击\r\n     */\r\n    private async avatarClick(){\r\n      console.log('avatarClick')\r\n      let uiCharacterDetail = await UIManager.Instance.show(\"UICharacterDetail\") as UICharacterDetail;\r\n      uiCharacterDetail.SendCharacterDetail(this.chatUserVo.userId, 0, 2);\r\n    }\r\n\r\n  onDestroy(){\r\n    EventManager.Instance.removeAll(this);\r\n  }\r\n}\r\n"]}