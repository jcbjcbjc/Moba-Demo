{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/UI/CharacterSelect/UICharacterSelect.ts"],"names":["_decorator","Component","director","Prefab","DataManager","TabView","EventManager","EventType","proto","UICharacterSelectItem","ListView","List","CharacterClass","ccclass","property","UICharacterSelect","start","tab","owner","listMain","isAddScene","Instance","addListener","TabView_OnTabSelect","OnTabSelect","UICharacterSelect_list","RefreshUI","console","log","ClearList","charactersMap","characters","characterDefineList","id","parseInt","define","index","Class","push","characterList","numItems","length","scrollTo","param","RemoveAll","OnCharacterListRender","node","uiCharacterSelectItem","getComponent","AddItem","SetItemInfo","back","loadScene","onDestroy","removeAll"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, Component, Node, Label, Sprite, SpriteFrame, loader, resources, director, Font, Prefab, instantiate } from 'cc';\r\nimport { MessageBox } from '../Common/MessageBox';\r\nimport { UIManager } from '../Common/UIManager';\r\nimport { UISystemConfig } from '../UISystemConfig';\r\nimport { User } from '../../Models/User';\r\nimport { LoadResUtil } from '../../Utils/LoadResUtil';\r\nimport { DataManager } from '../../Managers/DataManager';\r\nimport { TabView } from '../Common/TabView/TabView';\r\nimport { EventManager } from '../Common/Event/EventManager';\r\nimport { EventType } from '../Common/Event/EventType';\r\nimport { CharacterDefine } from '../../Data/CharacterDefine';\r\nimport proto from '../../../Proto/proto.js';\r\nimport { UICharacterSelectItem } from './UICharacterSelectItem';\r\nimport { ListView } from '../Common/ListView/ListView';\r\nimport { ListViewItem } from '../Common/ListView/ListViewItem';\r\nimport List from '../Common/ScrollView/List';\r\nconst { CharacterClass }=proto;\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * 英雄选择\r\n */\r\n@ccclass('UICharacterSelect')\r\nexport class UICharacterSelect extends Component {\r\n\r\n    @property(List) \r\n    private characterList = null as unknown as List;\r\n    @property(TabView)\r\n    public tab:TabView=null as unknown as TabView;\r\n    @property(Prefab)\r\n    public itemPrefab:Prefab=null as unknown as Prefab;\r\n    @property(ListView)\r\n    public listMain:ListView=null as unknown as ListView;\r\n\r\n    private characterDefineList:Array<CharacterDefine> = [];\r\n\r\n    private index:number=-1;  //选择索引\r\n    start () { \r\n        this.tab.owner=this;\r\n        this.listMain.isAddScene=false;\r\n        EventManager.Instance.addListener(EventType.TabView_OnTabSelect,this.OnTabSelect,this);\r\n        EventManager.Instance.addListener(EventType.UICharacterSelect_list,this.RefreshUI,this);\r\n    }\r\n\r\n    /**\r\n     * 刷新UI\r\n     */\r\n    public RefreshUI(){\r\n        console.log('RefreshUI')\r\n        \r\n        this.ClearList();\r\n        //获取对应索引的英雄\r\n       let charactersMap=DataManager.Instance.characters;\r\n       this.characterDefineList=[];\r\n       for(let id in charactersMap){\r\n           if(parseInt(id) > 1000){\r\n               continue;\r\n           }\r\n          let define=charactersMap[id];\r\n          if(this.index==0 || this.index+''==CharacterClass[define.Class]){  \r\n            this.characterDefineList.push(define);\r\n            // console.log('id='+define.ID)\r\n          }\r\n       }\r\n       this.characterList.numItems=this.characterDefineList.length;\r\n       this.characterList.scrollTo(0);\r\n    }\r\n\r\n    /**\r\n     * 切换选择\r\n     * @param param 索引\r\n     */\r\n    private OnTabSelect(param:any){\r\n        let index=param[0];\r\n        if(this.index==index){\r\n            return;\r\n        }\r\n        this.index=index;\r\n        console.log('OnTabSelect index='+this.index,this)\r\n       this.RefreshUI();\r\n    }\r\n\r\n    private ClearList():void\r\n    {\r\n        this.listMain.RemoveAll();\r\n    }\r\n\r\n    \r\n     /**\r\n     * 英雄列表渲染\r\n     * @param node\r\n     * @param index \r\n     */\r\n    OnCharacterListRender(node: Node, index: number) {\r\n        let uiCharacterSelectItem=node.getComponent(UICharacterSelectItem);\r\n        this.listMain.AddItem(node,uiCharacterSelectItem as ListViewItem);\r\n        uiCharacterSelectItem?.SetItemInfo(this.characterDefineList[index]);\r\n    }\r\n\r\n\r\n    /**\r\n     * 返回\r\n     */\r\n    back(){\r\n        director.loadScene('UIMain');\r\n    }\r\n\r\n    onDestroy(){\r\n        console.log('onDestroy')\r\n        EventManager.Instance.removeAll(this);\r\n    }\r\n\r\n}\r\n"]}