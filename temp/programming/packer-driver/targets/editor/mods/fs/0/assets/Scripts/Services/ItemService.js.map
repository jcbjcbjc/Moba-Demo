{"version":3,"sources":["file:///D:/LearningFrameWork/MobaYan/Moba/Src/Client/assets/Scripts/Services/ItemService.ts"],"names":["ItemService","LogUtil","proto","NetClient","EventManager","EventType","TipsManager","NetMessage","NetMessageRequest","UserLoginRequest","Result","UserLoginResponse","UserRegisterRequest","UserRegisterResponse","UnLockRequest","UnLockResponse","CharacterDetailRequest","CharacterDetailResponse","SwitchCharacterRequest","SwitchCharacterResponse","AttrPromoteRequest","AttrPromoteType","AttrPromoteInfoResponse","BagHandleRequest","BagHandleType","BagHandleResponse","ItemBuyRequest","ItemBuyResponse","QueryTranRequest","QueryTranResponse","BuyTranResponse","BuyTranRequest","Init","Instance","addListener","OnBagHandle","OnItemBuy","OnQueryTran","OnBuyTran","SendBagHandle","itemId","bagHandleType","money","log","message","Request","bagHandleReq","SendMessage","param","response","result","errormsg","Success","showTips","dispatch","OnBagHandle_UI","SendItemBuy","shopId","count","itemBuy","OnItemBuy_UI","SendQueryTran","userId","queryTranReq","OnQueryTran_UI","items","SendBuyTran","buyTranReq","OnBuyTran_UI"],"mappings":"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","sourcesContent":["import { LogUtil } from \"../Log/LogUtil\";\r\nimport proto from '../../Proto/proto.js';\r\nimport { NetClient } from \"../Network/NetClient\";\r\nimport { MessageBox, MessageBoxType } from \"../UI/Common/MessageBox\";\r\nimport { EventManager } from \"../UI/Common/Event/EventManager\";\r\nimport { EventType } from \"../UI/Common/Event/EventType\";\r\nimport { SocketConst } from \"../Network/SocketConst\";\r\nimport { User } from \"../Models/User\";\r\nimport { director } from \"cc\";\r\nimport { SoundManager } from \"../../Sound/SoundManager\";\r\nimport { SoundDefine } from \"../../Sound/SoundDefine\";\r\nimport { TipsManager } from \"../UI/TipsManager\";\r\nconst { NetMessage, NetMessageRequest, UserLoginRequest, Result, UserLoginResponse,UserRegisterRequest, UserRegisterResponse,UnLockRequest,\r\n    UnLockResponse,CharacterDetailRequest, CharacterDetailResponse,SwitchCharacterRequest, SwitchCharacterResponse,\r\n    AttrPromoteRequest, AttrPromoteType, AttrPromoteInfoResponse,BagHandleRequest, BagHandleType, BagHandleResponse,\r\n     ItemBuyRequest, ItemBuyResponse, QueryTranRequest, QueryTranResponse, BuyTranResponse, BuyTranRequest} = proto;\r\n\r\nexport class ItemService{\r\n   public static Instance: ItemService = new ItemService();\r\n\r\n   public Init() {\r\n      EventManager.Instance.addListener(EventType.OnBagHandle, this.OnBagHandle, this)\r\n      EventManager.Instance.addListener(EventType.OnItemBuy, this.OnItemBuy, this)\r\n      EventManager.Instance.addListener(EventType.OnQueryTran, this.OnQueryTran, this)\r\n      EventManager.Instance.addListener(EventType.OnBuyTran, this.OnBuyTran, this)\r\n   }\r\n\r\n    /**\r\n     * 请求背包操作\r\n     */\r\n    public SendBagHandle(itemId: number, bagHandleType:BagHandleType, money: number): void {\r\n        LogUtil.log(\"BagHandleRequest::itemId :\" + itemId+\"，bagHandleType=\"+bagHandleType+\"，money=\"+money);\r\n        let message = new NetMessage();\r\n        message.Request = new NetMessageRequest();\r\n        message.Request.bagHandleReq = new BagHandleRequest();\r\n        message.Request.bagHandleReq.itemId=itemId;\r\n        message.Request.bagHandleReq.bagHandleType=bagHandleType;\r\n        message.Request.bagHandleReq.money=money;\r\n        NetClient.Instance.SendMessage(message);\r\n    }\r\n\r\n    /**\r\n     * 背包操作响应\r\n     */\r\n    private OnBagHandle(param: any): void {\r\n        let response = param[0] as BagHandleResponse;\r\n        LogUtil.log(\"OnBagHandle:{0} [{1}]\", response.result, response.errormsg);\r\n        if(response.result == Result.Success){   //成功\r\n            TipsManager.Instance.showTips(response.errormsg);\r\n            EventManager.Instance.dispatch(EventType.OnBagHandle_UI,response); \r\n        }else{\r\n            TipsManager.Instance.showTips(response.errormsg);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 请求购买操作\r\n     */\r\n    public SendItemBuy(shopId: number, itemId: number, count: number): void {\r\n        LogUtil.log(\"ItemBuyRequest::shopId：\"+shopId+\"，itemId :\" + itemId+\"，count=\"+count);\r\n        let message = new NetMessage();\r\n        message.Request = new NetMessageRequest();\r\n        message.Request.itemBuy = new ItemBuyRequest();\r\n        message.Request.itemBuy.shopId=shopId;\r\n        message.Request.itemBuy.itemId=itemId;\r\n        message.Request.itemBuy.count=count;\r\n        NetClient.Instance.SendMessage(message);\r\n    }\r\n\r\n    /**\r\n     * 购买操作响应\r\n     */\r\n    private OnItemBuy(param: any): void {\r\n        let response = param[0] as ItemBuyResponse;\r\n        LogUtil.log(\"OnItemBuy:{0} [{1}]\", response.result, response.errormsg);\r\n        if(response.result == Result.Success){   //成功\r\n            TipsManager.Instance.showTips(response.errormsg);\r\n            EventManager.Instance.dispatch(EventType.OnItemBuy_UI,response); \r\n        }else{\r\n            TipsManager.Instance.showTips(response.errormsg);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 请求查询用户交易\r\n     */\r\n    public SendQueryTran(userId: number): void {\r\n        LogUtil.log(\"QueryTranRequest::userId：\"+userId);\r\n        let message = new NetMessage();\r\n        message.Request = new NetMessageRequest();\r\n        message.Request.queryTranReq = new QueryTranRequest();\r\n        message.Request.queryTranReq.userId=userId;\r\n        NetClient.Instance.SendMessage(message);\r\n    }\r\n    /**\r\n     * 查询用户交易响应\r\n     */\r\n    private OnQueryTran(param: any): void {\r\n        let response = param[0] as QueryTranResponse;\r\n        LogUtil.log(\"OnQueryTran:{0} [{1}]\", response.result, response.errormsg);\r\n        if(response.result == Result.Success){   //成功\r\n            TipsManager.Instance.showTips(response.errormsg);\r\n            EventManager.Instance.dispatch(EventType.OnQueryTran_UI,response.items); \r\n        }else{\r\n            TipsManager.Instance.showTips(response.errormsg);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 请求购买用户交易\r\n     */\r\n    public SendBuyTran(userId: number, itemId:number): void {\r\n        LogUtil.log(\"BuyTranRequest::userId：\"+userId+'，itemId='+itemId);\r\n        let message = new NetMessage();\r\n        message.Request = new NetMessageRequest();\r\n        message.Request.buyTranReq = new BuyTranRequest();\r\n        message.Request.buyTranReq.userId=userId;\r\n        message.Request.buyTranReq.itemId=itemId;\r\n        NetClient.Instance.SendMessage(message);\r\n    }\r\n    /**\r\n     * 购买用户交易响应\r\n     */\r\n    private OnBuyTran(param: any): void {\r\n        let response = param[0] as BuyTranResponse;\r\n        LogUtil.log(\"OnBuyTran:{0} [{1}]\", response.result, response.errormsg);\r\n        if(response.result == Result.Success){   //成功\r\n            TipsManager.Instance.showTips(response.errormsg);\r\n            EventManager.Instance.dispatch(EventType.OnBuyTran_UI); \r\n        }else{\r\n            TipsManager.Instance.showTips(response.errormsg);\r\n        }\r\n    }\r\n    \r\n\r\n}"]}